.include "macros.inc"

.section .text, "ax"  # 0x8000C860 - 0x804064E0

.global gti2GetChallenge
gti2GetChallenge:
/* 803733BC 0036913C  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 803733C0 00369140  7C 08 02 A6 */	mflr r0
/* 803733C4 00369144  90 01 00 24 */	stw r0, 0x24(r1)
/* 803733C8 00369148  39 61 00 20 */	addi r11, r1, 0x20
/* 803733CC 0036914C  48 07 DF 55 */	bl _savegpr_27
/* 803733D0 00369150  7C 7B 1B 78 */	mr r27, r3
/* 803733D4 00369154  4B FE A3 55 */	bl current_time
/* 803733D8 00369158  48 08 58 85 */	bl srand
/* 803733DC 0036915C  48 08 58 61 */	bl rand
/* 803733E0 00369160  3C 80 2C 0B */	lis r4, 0x2C0B02C1@ha
/* 803733E4 00369164  3B 80 00 00 */	li r28, 0
/* 803733E8 00369168  3B E4 02 C1 */	addi r31, r4, 0x2C0B02C1@l
/* 803733EC 0036916C  3B A0 00 01 */	li r29, 1
/* 803733F0 00369170  7C 1F 18 96 */	mulhw r0, r31, r3
/* 803733F4 00369174  7C 00 26 70 */	srawi r0, r0, 4
/* 803733F8 00369178  54 04 0F FE */	srwi r4, r0, 0x1f
/* 803733FC 0036917C  7C 00 22 14 */	add r0, r0, r4
/* 80373400 00369180  1C 00 00 5D */	mulli r0, r0, 0x5d
/* 80373404 00369184  7C 60 18 50 */	subf r3, r0, r3
/* 80373408 00369188  38 03 00 21 */	addi r0, r3, 0x21
/* 8037340C 0036918C  98 1B 00 00 */	stb r0, 0(r27)
lbl_80373410:
/* 80373410 00369190  7F DB EA 14 */	add r30, r27, r29
/* 80373414 00369194  88 BB 00 00 */	lbz r5, 0(r27)
/* 80373418 00369198  88 DE FF FF */	lbz r6, -1(r30)
/* 8037341C 0036919C  54 A4 07 FE */	clrlwi r4, r5, 0x1f
/* 80373420 003691A0  38 05 FF B1 */	addi r0, r5, -79
/* 80373424 003691A4  7F A3 32 78 */	xor r3, r29, r6
/* 80373428 003691A8  7C A5 30 50 */	subf r5, r5, r6
/* 8037342C 003691AC  7C 84 E2 78 */	xor r4, r4, r28
/* 80373430 003691B0  54 00 0F FE */	srwi r0, r0, 0x1f
/* 80373434 003691B4  54 63 07 FE */	clrlwi r3, r3, 0x1f
/* 80373438 003691B8  54 A5 0F FE */	srwi r5, r5, 0x1f
/* 8037343C 003691BC  7C 83 1A 78 */	xor r3, r4, r3
/* 80373440 003691C0  7C 60 02 78 */	xor r0, r3, r0
/* 80373444 003691C4  7C 1C 2A 78 */	xor r28, r0, r5
/* 80373448 003691C8  48 08 57 F5 */	bl rand
/* 8037344C 003691CC  7C 1F 18 96 */	mulhw r0, r31, r3
/* 80373450 003691D0  2C 1C 00 00 */	cmpwi r28, 0
/* 80373454 003691D4  7C 00 26 70 */	srawi r0, r0, 4
/* 80373458 003691D8  54 04 0F FE */	srwi r4, r0, 0x1f
/* 8037345C 003691DC  7C 00 22 14 */	add r0, r0, r4
/* 80373460 003691E0  1C 00 00 5D */	mulli r0, r0, 0x5d
/* 80373464 003691E4  7C 60 18 50 */	subf r3, r0, r3
/* 80373468 003691E8  38 03 00 21 */	addi r0, r3, 0x21
/* 8037346C 003691EC  98 1E 00 00 */	stb r0, 0(r30)
/* 80373470 003691F0  41 82 00 10 */	beq lbl_80373480
/* 80373474 003691F4  88 1E 00 00 */	lbz r0, 0(r30)
/* 80373478 003691F8  54 00 07 FF */	clrlwi. r0, r0, 0x1f
/* 8037347C 003691FC  41 82 00 1C */	beq lbl_80373498
lbl_80373480:
/* 80373480 00369200  2C 1C 00 00 */	cmpwi r28, 0
/* 80373484 00369204  40 82 00 20 */	bne lbl_803734A4
/* 80373488 00369208  88 1E 00 00 */	lbz r0, 0(r30)
/* 8037348C 0036920C  54 00 07 FE */	clrlwi r0, r0, 0x1f
/* 80373490 00369210  2C 00 00 01 */	cmpwi r0, 1
/* 80373494 00369214  40 82 00 10 */	bne lbl_803734A4
lbl_80373498:
/* 80373498 00369218  88 7E 00 00 */	lbz r3, 0(r30)
/* 8037349C 0036921C  38 03 00 01 */	addi r0, r3, 1
/* 803734A0 00369220  98 1E 00 00 */	stb r0, 0(r30)
lbl_803734A4:
/* 803734A4 00369224  3B BD 00 01 */	addi r29, r29, 1
/* 803734A8 00369228  2C 1D 00 20 */	cmpwi r29, 0x20
/* 803734AC 0036922C  41 80 FF 64 */	blt lbl_80373410
/* 803734B0 00369230  39 61 00 20 */	addi r11, r1, 0x20
/* 803734B4 00369234  7F 63 DB 78 */	mr r3, r27
/* 803734B8 00369238  48 07 DE B5 */	bl _restgpr_27
/* 803734BC 0036923C  80 01 00 24 */	lwz r0, 0x24(r1)
/* 803734C0 00369240  7C 08 03 A6 */	mtlr r0
/* 803734C4 00369244  38 21 00 20 */	addi r1, r1, 0x20
/* 803734C8 00369248  4E 80 00 20 */	blr 

.global gti2GetResponse
gti2GetResponse:
/* 803734CC 0036924C  94 21 FF D0 */	stwu r1, -0x30(r1)
/* 803734D0 00369250  7C 08 02 A6 */	mflr r0
/* 803734D4 00369254  90 01 00 34 */	stw r0, 0x34(r1)
/* 803734D8 00369258  39 61 00 30 */	addi r11, r1, 0x30
/* 803734DC 0036925C  48 07 DE 35 */	bl _savegpr_23
/* 803734E0 00369260  3C A0 80 49 */	lis r5, lbl_8048FBB8@ha
/* 803734E4 00369264  7C 79 1B 78 */	mr r25, r3
/* 803734E8 00369268  7C 9A 23 78 */	mr r26, r4
/* 803734EC 0036926C  38 65 FB B8 */	addi r3, r5, lbl_8048FBB8@l
/* 803734F0 00369270  48 07 D1 51 */	bl strlen
/* 803734F4 00369274  38 00 00 1F */	li r0, 0x1f
/* 803734F8 00369278  7C 7E 1B 78 */	mr r30, r3
/* 803734FC 0036927C  38 E0 00 00 */	li r7, 0
/* 80373500 00369280  38 C0 00 01 */	li r6, 1
/* 80373504 00369284  7C 09 03 A6 */	mtctr r0
lbl_80373508:
/* 80373508 00369288  7D 1A 32 14 */	add r8, r26, r6
/* 8037350C 0036928C  88 BA 00 00 */	lbz r5, 0(r26)
/* 80373510 00369290  89 28 FF FF */	lbz r9, -1(r8)
/* 80373514 00369294  54 A4 07 FE */	clrlwi r4, r5, 0x1f
/* 80373518 00369298  38 05 FF B1 */	addi r0, r5, -79
/* 8037351C 0036929C  7C C3 4A 78 */	xor r3, r6, r9
/* 80373520 003692A0  7C A5 48 50 */	subf r5, r5, r9
/* 80373524 003692A4  7C 84 3A 78 */	xor r4, r4, r7
/* 80373528 003692A8  54 00 0F FE */	srwi r0, r0, 0x1f
/* 8037352C 003692AC  54 63 07 FE */	clrlwi r3, r3, 0x1f
/* 80373530 003692B0  54 A5 0F FE */	srwi r5, r5, 0x1f
/* 80373534 003692B4  7C 83 1A 78 */	xor r3, r4, r3
/* 80373538 003692B8  7C 60 02 78 */	xor r0, r3, r0
/* 8037353C 003692BC  7C 07 2A 79 */	xor. r7, r0, r5
/* 80373540 003692C0  41 82 00 10 */	beq lbl_80373550
/* 80373544 003692C4  88 08 00 00 */	lbz r0, 0(r8)
/* 80373548 003692C8  54 00 07 FF */	clrlwi. r0, r0, 0x1f
/* 8037354C 003692CC  41 82 00 1C */	beq lbl_80373568
lbl_80373550:
/* 80373550 003692D0  2C 07 00 00 */	cmpwi r7, 0
/* 80373554 003692D4  40 82 00 1C */	bne lbl_80373570
/* 80373558 003692D8  88 08 00 00 */	lbz r0, 0(r8)
/* 8037355C 003692DC  54 00 07 FE */	clrlwi r0, r0, 0x1f
/* 80373560 003692E0  2C 00 00 01 */	cmpwi r0, 1
/* 80373564 003692E4  40 82 00 0C */	bne lbl_80373570
lbl_80373568:
/* 80373568 003692E8  3B A0 00 00 */	li r29, 0
/* 8037356C 003692EC  48 00 00 10 */	b lbl_8037357C
lbl_80373570:
/* 80373570 003692F0  38 C6 00 01 */	addi r6, r6, 1
/* 80373574 003692F4  42 00 FF 94 */	bdnz lbl_80373508
/* 80373578 003692F8  3B A0 00 01 */	li r29, 1
lbl_8037357C:
/* 8037357C 003692FC  3F E0 80 49 */	lis r31, lbl_8048FBB8@ha
/* 80373580 00369300  7F 38 CB 78 */	mr r24, r25
/* 80373584 00369304  3B FF FB B8 */	addi r31, r31, lbl_8048FBB8@l
/* 80373588 00369308  3B 60 00 00 */	li r27, 0
/* 8037358C 0036930C  3B 80 00 00 */	li r28, 0
/* 80373590 00369310  3E E0 2C 0B */	lis r23, 0x2c0b
lbl_80373594:
/* 80373594 00369314  2C 1D 00 00 */	cmpwi r29, 0
/* 80373598 00369318  41 82 00 14 */	beq lbl_803735AC
/* 8037359C 0036931C  2C 1B 00 00 */	cmpwi r27, 0
/* 803735A0 00369320  41 82 00 0C */	beq lbl_803735AC
/* 803735A4 00369324  2C 1B 00 0D */	cmpwi r27, 0xd
/* 803735A8 00369328  40 82 00 30 */	bne lbl_803735D8
lbl_803735AC:
/* 803735AC 0036932C  48 08 56 91 */	bl rand
/* 803735B0 00369330  38 17 02 C1 */	addi r0, r23, 0x2c1
/* 803735B4 00369334  7C 00 18 96 */	mulhw r0, r0, r3
/* 803735B8 00369338  7C 00 26 70 */	srawi r0, r0, 4
/* 803735BC 0036933C  54 04 0F FE */	srwi r4, r0, 0x1f
/* 803735C0 00369340  7C 00 22 14 */	add r0, r0, r4
/* 803735C4 00369344  1C 00 00 5D */	mulli r0, r0, 0x5d
/* 803735C8 00369348  7C 60 18 50 */	subf r3, r0, r3
/* 803735CC 0036934C  38 03 00 21 */	addi r0, r3, 0x21
/* 803735D0 00369350  98 18 00 00 */	stb r0, 0(r24)
/* 803735D4 00369354  48 00 00 B8 */	b lbl_8037368C
lbl_803735D8:
/* 803735D8 00369358  2C 1B 00 01 */	cmpwi r27, 1
/* 803735DC 0036935C  41 82 00 0C */	beq lbl_803735E8
/* 803735E0 00369360  2C 1B 00 0E */	cmpwi r27, 0xe
/* 803735E4 00369364  40 82 00 14 */	bne lbl_803735F8
lbl_803735E8:
/* 803735E8 00369368  7C 1A D8 AE */	lbzx r0, r26, r27
/* 803735EC 0036936C  7C 7A DA 14 */	add r3, r26, r27
/* 803735F0 00369370  7C 00 07 74 */	extsb r0, r0
/* 803735F4 00369374  48 00 00 10 */	b lbl_80373604
lbl_803735F8:
/* 803735F8 00369378  7C 7A DA 14 */	add r3, r26, r27
/* 803735FC 0036937C  88 03 FF FF */	lbz r0, -1(r3)
/* 80373600 00369380  7C 00 07 74 */	extsb r0, r0
lbl_80373604:
/* 80373604 00369384  88 E3 00 00 */	lbz r7, 0(r3)
/* 80373608 00369388  7C 80 E1 D6 */	mullw r4, r0, r28
/* 8037360C 0036938C  38 17 02 C1 */	addi r0, r23, 0x2c1
/* 80373610 00369390  7C DB 3A 14 */	add r6, r27, r7
/* 80373614 00369394  7C A6 F3 D6 */	divw r5, r6, r30
/* 80373618 00369398  7C 64 F3 D6 */	divw r3, r4, r30
/* 8037361C 0036939C  7C A5 F1 D6 */	mullw r5, r5, r30
/* 80373620 003693A0  7C A5 30 50 */	subf r5, r5, r6
/* 80373624 003693A4  7C BF 28 AE */	lbzx r5, r31, r5
/* 80373628 003693A8  7C 63 F1 D6 */	mullw r3, r3, r30
/* 8037362C 003693AC  7C A6 07 74 */	extsb r6, r5
/* 80373630 003693B0  7C BB 39 D6 */	mullw r5, r27, r7
/* 80373634 003693B4  7C 63 20 50 */	subf r3, r3, r4
/* 80373638 003693B8  7C 7F 18 AE */	lbzx r3, r31, r3
/* 8037363C 003693BC  7C 63 07 74 */	extsb r3, r3
/* 80373640 003693C0  7C A6 2A 14 */	add r5, r6, r5
/* 80373644 003693C4  54 A4 D8 08 */	slwi r4, r5, 0x1b
/* 80373648 003693C8  54 A5 0F FE */	srwi r5, r5, 0x1f
/* 8037364C 003693CC  7C 85 20 50 */	subf r4, r5, r4
/* 80373650 003693D0  54 84 28 3E */	rotlwi r4, r4, 5
/* 80373654 003693D4  7C 84 2A 14 */	add r4, r4, r5
/* 80373658 003693D8  7C 9A 20 AE */	lbzx r4, r26, r4
/* 8037365C 003693DC  7C 84 1A 78 */	xor r4, r4, r3
/* 80373660 003693E0  7C 83 FE 70 */	srawi r3, r4, 0x1f
/* 80373664 003693E4  7C 64 22 78 */	xor r4, r3, r4
/* 80373668 003693E8  7C 83 20 50 */	subf r4, r3, r4
/* 8037366C 003693EC  7C 00 20 96 */	mulhw r0, r0, r4
/* 80373670 003693F0  7C 00 26 70 */	srawi r0, r0, 4
/* 80373674 003693F4  54 03 0F FE */	srwi r3, r0, 0x1f
/* 80373678 003693F8  7C 00 1A 14 */	add r0, r0, r3
/* 8037367C 003693FC  1C 00 00 5D */	mulli r0, r0, 0x5d
/* 80373680 00369400  7C 60 20 50 */	subf r3, r0, r4
/* 80373684 00369404  38 03 00 21 */	addi r0, r3, 0x21
/* 80373688 00369408  98 18 00 00 */	stb r0, 0(r24)
lbl_8037368C:
/* 8037368C 0036940C  3B 7B 00 01 */	addi r27, r27, 1
/* 80373690 00369410  3B 18 00 01 */	addi r24, r24, 1
/* 80373694 00369414  2C 1B 00 20 */	cmpwi r27, 0x20
/* 80373698 00369418  3B 9C 46 47 */	addi r28, r28, 0x4647
/* 8037369C 0036941C  41 80 FE F8 */	blt lbl_80373594
/* 803736A0 00369420  39 61 00 30 */	addi r11, r1, 0x30
/* 803736A4 00369424  7F 23 CB 78 */	mr r3, r25
/* 803736A8 00369428  48 07 DC B5 */	bl _restgpr_23
/* 803736AC 0036942C  80 01 00 34 */	lwz r0, 0x34(r1)
/* 803736B0 00369430  7C 08 03 A6 */	mtlr r0
/* 803736B4 00369434  38 21 00 30 */	addi r1, r1, 0x30
/* 803736B8 00369438  4E 80 00 20 */	blr 

.global gti2CheckResponse
gti2CheckResponse:
/* 803736BC 0036943C  38 00 00 08 */	li r0, 8
/* 803736C0 00369440  38 C0 00 00 */	li r6, 0
/* 803736C4 00369444  7C 09 03 A6 */	mtctr r0
lbl_803736C8:
/* 803736C8 00369448  2C 06 00 00 */	cmpwi r6, 0
/* 803736CC 0036944C  41 82 00 24 */	beq lbl_803736F0
/* 803736D0 00369450  2C 06 00 0D */	cmpwi r6, 0xd
/* 803736D4 00369454  41 82 00 1C */	beq lbl_803736F0
/* 803736D8 00369458  88 A3 00 00 */	lbz r5, 0(r3)
/* 803736DC 0036945C  88 04 00 00 */	lbz r0, 0(r4)
/* 803736E0 00369460  7C 05 00 40 */	cmplw r5, r0
/* 803736E4 00369464  41 82 00 0C */	beq lbl_803736F0
/* 803736E8 00369468  38 60 00 00 */	li r3, 0
/* 803736EC 0036946C  4E 80 00 20 */	blr 
lbl_803736F0:
/* 803736F0 00369470  34 C6 00 01 */	addic. r6, r6, 1
/* 803736F4 00369474  41 82 00 24 */	beq lbl_80373718
/* 803736F8 00369478  2C 06 00 0D */	cmpwi r6, 0xd
/* 803736FC 0036947C  41 82 00 1C */	beq lbl_80373718
/* 80373700 00369480  88 A3 00 01 */	lbz r5, 1(r3)
/* 80373704 00369484  88 04 00 01 */	lbz r0, 1(r4)
/* 80373708 00369488  7C 05 00 40 */	cmplw r5, r0
/* 8037370C 0036948C  41 82 00 0C */	beq lbl_80373718
/* 80373710 00369490  38 60 00 00 */	li r3, 0
/* 80373714 00369494  4E 80 00 20 */	blr 
lbl_80373718:
/* 80373718 00369498  34 C6 00 01 */	addic. r6, r6, 1
/* 8037371C 0036949C  41 82 00 24 */	beq lbl_80373740
/* 80373720 003694A0  2C 06 00 0D */	cmpwi r6, 0xd
/* 80373724 003694A4  41 82 00 1C */	beq lbl_80373740
/* 80373728 003694A8  88 A3 00 02 */	lbz r5, 2(r3)
/* 8037372C 003694AC  88 04 00 02 */	lbz r0, 2(r4)
/* 80373730 003694B0  7C 05 00 40 */	cmplw r5, r0
/* 80373734 003694B4  41 82 00 0C */	beq lbl_80373740
/* 80373738 003694B8  38 60 00 00 */	li r3, 0
/* 8037373C 003694BC  4E 80 00 20 */	blr 
lbl_80373740:
/* 80373740 003694C0  34 C6 00 01 */	addic. r6, r6, 1
/* 80373744 003694C4  41 82 00 24 */	beq lbl_80373768
/* 80373748 003694C8  2C 06 00 0D */	cmpwi r6, 0xd
/* 8037374C 003694CC  41 82 00 1C */	beq lbl_80373768
/* 80373750 003694D0  88 A3 00 03 */	lbz r5, 3(r3)
/* 80373754 003694D4  88 04 00 03 */	lbz r0, 3(r4)
/* 80373758 003694D8  7C 05 00 40 */	cmplw r5, r0
/* 8037375C 003694DC  41 82 00 0C */	beq lbl_80373768
/* 80373760 003694E0  38 60 00 00 */	li r3, 0
/* 80373764 003694E4  4E 80 00 20 */	blr 
lbl_80373768:
/* 80373768 003694E8  38 C6 00 01 */	addi r6, r6, 1
/* 8037376C 003694EC  38 84 00 04 */	addi r4, r4, 4
/* 80373770 003694F0  38 63 00 04 */	addi r3, r3, 4
/* 80373774 003694F4  42 00 FF 54 */	bdnz lbl_803736C8
/* 80373778 003694F8  38 60 00 01 */	li r3, 1
/* 8037377C 003694FC  4E 80 00 20 */	blr 

