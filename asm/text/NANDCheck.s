.include "macros.inc"

.section .text, "ax"  # 0x8000C860 - 0x804064E0

.global nandCalcUsage
nandCalcUsage:
/* 8020D844 002035C4  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8020D848 002035C8  7C 08 02 A6 */	mflr r0
/* 8020D84C 002035CC  90 01 00 24 */	stw r0, 0x24(r1)
/* 8020D850 002035D0  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 8020D854 002035D4  3B E0 00 00 */	li r31, 0
/* 8020D858 002035D8  93 C1 00 18 */	stw r30, 0x18(r1)
/* 8020D85C 002035DC  7C BE 2B 78 */	mr r30, r5
/* 8020D860 002035E0  93 A1 00 14 */	stw r29, 0x14(r1)
/* 8020D864 002035E4  7C 9D 23 78 */	mr r29, r4
/* 8020D868 002035E8  93 81 00 10 */	stw r28, 0x10(r1)
/* 8020D86C 002035EC  7C 7C 1B 78 */	mr r28, r3
/* 8020D870 002035F0  93 E3 00 00 */	stw r31, 0(r3)
/* 8020D874 002035F4  38 60 FF 8B */	li r3, -117
/* 8020D878 002035F8  93 E4 00 00 */	stw r31, 0(r4)
/* 8020D87C 002035FC  48 00 00 58 */	b lbl_8020D8D4
lbl_8020D880:
/* 8020D880 00203600  93 E1 00 0C */	stw r31, 0xc(r1)
/* 8020D884 00203604  38 81 00 0C */	addi r4, r1, 0xc
/* 8020D888 00203608  38 A1 00 08 */	addi r5, r1, 8
/* 8020D88C 0020360C  93 E1 00 08 */	stw r31, 8(r1)
/* 8020D890 00203610  80 7E 00 00 */	lwz r3, 0(r30)
/* 8020D894 00203614  48 00 72 05 */	bl ISFS_GetUsage
/* 8020D898 00203618  2C 03 00 00 */	cmpwi r3, 0
/* 8020D89C 0020361C  40 82 00 28 */	bne lbl_8020D8C4
/* 8020D8A0 00203620  80 9C 00 00 */	lwz r4, 0(r28)
/* 8020D8A4 00203624  80 01 00 0C */	lwz r0, 0xc(r1)
/* 8020D8A8 00203628  7C 04 02 14 */	add r0, r4, r0
/* 8020D8AC 0020362C  90 1C 00 00 */	stw r0, 0(r28)
/* 8020D8B0 00203630  80 9D 00 00 */	lwz r4, 0(r29)
/* 8020D8B4 00203634  80 01 00 08 */	lwz r0, 8(r1)
/* 8020D8B8 00203638  7C 04 02 14 */	add r0, r4, r0
/* 8020D8BC 0020363C  90 1D 00 00 */	stw r0, 0(r29)
/* 8020D8C0 00203640  48 00 00 10 */	b lbl_8020D8D0
lbl_8020D8C4:
/* 8020D8C4 00203644  2C 03 FF 96 */	cmpwi r3, -106
/* 8020D8C8 00203648  40 82 00 18 */	bne lbl_8020D8E0
/* 8020D8CC 0020364C  38 60 00 00 */	li r3, 0
lbl_8020D8D0:
/* 8020D8D0 00203650  3B DE 00 04 */	addi r30, r30, 4
lbl_8020D8D4:
/* 8020D8D4 00203654  80 1E 00 00 */	lwz r0, 0(r30)
/* 8020D8D8 00203658  2C 00 00 00 */	cmpwi r0, 0
/* 8020D8DC 0020365C  40 82 FF A4 */	bne lbl_8020D880
lbl_8020D8E0:
/* 8020D8E0 00203660  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8020D8E4 00203664  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 8020D8E8 00203668  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 8020D8EC 0020366C  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 8020D8F0 00203670  83 81 00 10 */	lwz r28, 0x10(r1)
/* 8020D8F4 00203674  7C 08 03 A6 */	mtlr r0
/* 8020D8F8 00203678  38 21 00 20 */	addi r1, r1, 0x20
/* 8020D8FC 0020367C  4E 80 00 20 */	blr 

.global NANDCheck
NANDCheck:
/* 8020D900 00203680  94 21 FF D0 */	stwu r1, -0x30(r1)
/* 8020D904 00203684  7C 08 02 A6 */	mflr r0
/* 8020D908 00203688  90 01 00 34 */	stw r0, 0x34(r1)
/* 8020D90C 0020368C  38 00 FF FF */	li r0, -1
/* 8020D910 00203690  93 E1 00 2C */	stw r31, 0x2c(r1)
/* 8020D914 00203694  7C BF 2B 78 */	mr r31, r5
/* 8020D918 00203698  93 C1 00 28 */	stw r30, 0x28(r1)
/* 8020D91C 0020369C  7C 9E 23 78 */	mr r30, r4
/* 8020D920 002036A0  93 A1 00 24 */	stw r29, 0x24(r1)
/* 8020D924 002036A4  7C 7D 1B 78 */	mr r29, r3
/* 8020D928 002036A8  90 01 00 14 */	stw r0, 0x14(r1)
/* 8020D92C 002036AC  90 01 00 10 */	stw r0, 0x10(r1)
/* 8020D930 002036B0  90 01 00 0C */	stw r0, 0xc(r1)
/* 8020D934 002036B4  90 01 00 08 */	stw r0, 8(r1)
/* 8020D938 002036B8  4B FF F1 9D */	bl nandIsInitialized
/* 8020D93C 002036BC  2C 03 00 00 */	cmpwi r3, 0
/* 8020D940 002036C0  40 82 00 0C */	bne lbl_8020D94C
/* 8020D944 002036C4  38 60 FF 80 */	li r3, -128
/* 8020D948 002036C8  48 00 00 A4 */	b lbl_8020D9EC
lbl_8020D94C:
/* 8020D94C 002036CC  4B FF FE 65 */	bl nandGetHomeDir
/* 8020D950 002036D0  38 81 00 14 */	addi r4, r1, 0x14
/* 8020D954 002036D4  38 A1 00 10 */	addi r5, r1, 0x10
/* 8020D958 002036D8  48 00 71 41 */	bl ISFS_GetUsage
/* 8020D95C 002036DC  2C 03 00 00 */	cmpwi r3, 0
/* 8020D960 002036E0  41 82 00 0C */	beq lbl_8020D96C
/* 8020D964 002036E4  4B FF F1 89 */	bl nandConvertErrorCode
/* 8020D968 002036E8  48 00 00 84 */	b lbl_8020D9EC
lbl_8020D96C:
/* 8020D96C 002036EC  3C A0 80 48 */	lis r5, lbl_8047C290@ha
/* 8020D970 002036F0  38 61 00 0C */	addi r3, r1, 0xc
/* 8020D974 002036F4  38 81 00 08 */	addi r4, r1, 8
/* 8020D978 002036F8  38 A5 C2 90 */	addi r5, r5, lbl_8047C290@l
/* 8020D97C 002036FC  4B FF FE C9 */	bl nandCalcUsage
/* 8020D980 00203700  2C 03 00 00 */	cmpwi r3, 0
/* 8020D984 00203704  41 82 00 0C */	beq lbl_8020D990
/* 8020D988 00203708  4B FF F1 65 */	bl nandConvertErrorCode
/* 8020D98C 0020370C  48 00 00 60 */	b lbl_8020D9EC
lbl_8020D990:
/* 8020D990 00203710  80 01 00 14 */	lwz r0, 0x14(r1)
/* 8020D994 00203714  38 A0 00 00 */	li r5, 0
/* 8020D998 00203718  80 81 00 08 */	lwz r4, 8(r1)
/* 8020D99C 0020371C  7C 00 EA 14 */	add r0, r0, r29
/* 8020D9A0 00203720  80 61 00 0C */	lwz r3, 0xc(r1)
/* 8020D9A4 00203724  28 00 04 00 */	cmplwi r0, 0x400
/* 8020D9A8 00203728  80 01 00 10 */	lwz r0, 0x10(r1)
/* 8020D9AC 0020372C  40 81 00 08 */	ble lbl_8020D9B4
/* 8020D9B0 00203730  60 A5 00 01 */	ori r5, r5, 1
lbl_8020D9B4:
/* 8020D9B4 00203734  7C 00 F2 14 */	add r0, r0, r30
/* 8020D9B8 00203738  28 00 00 21 */	cmplwi r0, 0x21
/* 8020D9BC 0020373C  40 81 00 08 */	ble lbl_8020D9C4
/* 8020D9C0 00203740  60 A5 00 02 */	ori r5, r5, 2
lbl_8020D9C4:
/* 8020D9C4 00203744  7C 03 EA 14 */	add r0, r3, r29
/* 8020D9C8 00203748  28 00 44 00 */	cmplwi r0, 0x4400
/* 8020D9CC 0020374C  40 81 00 08 */	ble lbl_8020D9D4
/* 8020D9D0 00203750  60 A5 00 04 */	ori r5, r5, 4
lbl_8020D9D4:
/* 8020D9D4 00203754  7C 04 F2 14 */	add r0, r4, r30
/* 8020D9D8 00203758  28 00 0F A0 */	cmplwi r0, 0xfa0
/* 8020D9DC 0020375C  40 81 00 08 */	ble lbl_8020D9E4
/* 8020D9E0 00203760  60 A5 00 08 */	ori r5, r5, 8
lbl_8020D9E4:
/* 8020D9E4 00203764  90 BF 00 00 */	stw r5, 0(r31)
/* 8020D9E8 00203768  38 60 00 00 */	li r3, 0
lbl_8020D9EC:
/* 8020D9EC 0020376C  80 01 00 34 */	lwz r0, 0x34(r1)
/* 8020D9F0 00203770  83 E1 00 2C */	lwz r31, 0x2c(r1)
/* 8020D9F4 00203774  83 C1 00 28 */	lwz r30, 0x28(r1)
/* 8020D9F8 00203778  83 A1 00 24 */	lwz r29, 0x24(r1)
/* 8020D9FC 0020377C  7C 08 03 A6 */	mtlr r0
/* 8020DA00 00203780  38 21 00 30 */	addi r1, r1, 0x30
/* 8020DA04 00203784  4E 80 00 20 */	blr 

.global NANDGetAvailableArea
NANDGetAvailableArea:
/* 8020DA08 00203788  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8020DA0C 0020378C  7C 08 02 A6 */	mflr r0
/* 8020DA10 00203790  90 01 00 24 */	stw r0, 0x24(r1)
/* 8020DA14 00203794  38 00 FF FF */	li r0, -1
/* 8020DA18 00203798  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 8020DA1C 0020379C  7C 9F 23 78 */	mr r31, r4
/* 8020DA20 002037A0  93 C1 00 18 */	stw r30, 0x18(r1)
/* 8020DA24 002037A4  7C 7E 1B 78 */	mr r30, r3
/* 8020DA28 002037A8  90 01 00 14 */	stw r0, 0x14(r1)
/* 8020DA2C 002037AC  90 01 00 10 */	stw r0, 0x10(r1)
/* 8020DA30 002037B0  90 01 00 0C */	stw r0, 0xc(r1)
/* 8020DA34 002037B4  90 01 00 08 */	stw r0, 8(r1)
/* 8020DA38 002037B8  4B FF FD 79 */	bl nandGetHomeDir
/* 8020DA3C 002037BC  38 81 00 0C */	addi r4, r1, 0xc
/* 8020DA40 002037C0  38 A1 00 08 */	addi r5, r1, 8
/* 8020DA44 002037C4  48 00 70 55 */	bl ISFS_GetUsage
/* 8020DA48 002037C8  2C 03 00 00 */	cmpwi r3, 0
/* 8020DA4C 002037CC  41 82 00 08 */	beq lbl_8020DA54
/* 8020DA50 002037D0  4B FF F0 9D */	bl nandConvertErrorCode
lbl_8020DA54:
/* 8020DA54 002037D4  80 C1 00 08 */	lwz r6, 8(r1)
/* 8020DA58 002037D8  3C A0 80 48 */	lis r5, lbl_8047C290@ha
/* 8020DA5C 002037DC  38 61 00 14 */	addi r3, r1, 0x14
/* 8020DA60 002037E0  38 81 00 10 */	addi r4, r1, 0x10
/* 8020DA64 002037E4  38 06 FF FF */	addi r0, r6, -1
/* 8020DA68 002037E8  38 A5 C2 90 */	addi r5, r5, lbl_8047C290@l
/* 8020DA6C 002037EC  90 01 00 08 */	stw r0, 8(r1)
/* 8020DA70 002037F0  4B FF FD D5 */	bl nandCalcUsage
/* 8020DA74 002037F4  2C 03 00 00 */	cmpwi r3, 0
/* 8020DA78 002037F8  41 82 00 08 */	beq lbl_8020DA80
/* 8020DA7C 002037FC  4B FF F0 71 */	bl nandConvertErrorCode
lbl_8020DA80:
/* 8020DA80 00203800  80 81 00 14 */	lwz r4, 0x14(r1)
/* 8020DA84 00203804  38 60 44 00 */	li r3, 0x4400
/* 8020DA88 00203808  81 01 00 10 */	lwz r8, 0x10(r1)
/* 8020DA8C 0020380C  38 00 0F A0 */	li r0, 0xfa0
/* 8020DA90 00203810  7C 64 18 10 */	subfc r3, r4, r3
/* 8020DA94 00203814  81 21 00 0C */	lwz r9, 0xc(r1)
/* 8020DA98 00203818  7C E3 19 10 */	subfe r7, r3, r3
/* 8020DA9C 0020381C  81 41 00 08 */	lwz r10, 8(r1)
/* 8020DAA0 00203820  20 A4 44 00 */	subfic r5, r4, 0x4400
/* 8020DAA4 00203824  38 60 04 00 */	li r3, 0x400
/* 8020DAA8 00203828  7C 88 00 10 */	subfc r4, r8, r0
/* 8020DAAC 0020382C  38 00 00 20 */	li r0, 0x20
/* 8020DAB0 00203830  7C C4 21 10 */	subfe r6, r4, r4
/* 8020DAB4 00203834  7C A7 38 78 */	andc r7, r5, r7
/* 8020DAB8 00203838  20 A8 0F A0 */	subfic r5, r8, 0xfa0
/* 8020DABC 0020383C  7C 69 18 10 */	subfc r3, r9, r3
/* 8020DAC0 00203840  7C 83 19 10 */	subfe r4, r3, r3
/* 8020DAC4 00203844  7C A5 30 78 */	andc r5, r5, r6
/* 8020DAC8 00203848  20 69 04 00 */	subfic r3, r9, 0x400
/* 8020DACC 0020384C  7C 64 20 78 */	andc r4, r3, r4
/* 8020DAD0 00203850  7C 0A 00 10 */	subfc r0, r10, r0
/* 8020DAD4 00203854  7C 60 01 10 */	subfe r3, r0, r0
/* 8020DAD8 00203858  20 0A 00 20 */	subfic r0, r10, 0x20
/* 8020DADC 0020385C  7C 07 20 40 */	cmplw r7, r4
/* 8020DAE0 00203860  7C 00 18 78 */	andc r0, r0, r3
/* 8020DAE4 00203864  40 80 00 08 */	bge lbl_8020DAEC
/* 8020DAE8 00203868  7C E4 3B 78 */	mr r4, r7
lbl_8020DAEC:
/* 8020DAEC 0020386C  7C 05 00 40 */	cmplw r5, r0
/* 8020DAF0 00203870  90 9E 00 00 */	stw r4, 0(r30)
/* 8020DAF4 00203874  40 80 00 08 */	bge lbl_8020DAFC
/* 8020DAF8 00203878  7C A0 2B 78 */	mr r0, r5
lbl_8020DAFC:
/* 8020DAFC 0020387C  90 1F 00 00 */	stw r0, 0(r31)
/* 8020DB00 00203880  38 60 00 00 */	li r3, 0
/* 8020DB04 00203884  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 8020DB08 00203888  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 8020DB0C 0020388C  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8020DB10 00203890  7C 08 03 A6 */	mtlr r0
/* 8020DB14 00203894  38 21 00 20 */	addi r1, r1, 0x20
/* 8020DB18 00203898  4E 80 00 20 */	blr 

