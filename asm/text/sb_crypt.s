.include "macros.inc"

.section .text, "ax"  # 0x8000C860 - 0x804064E0

.global keyrand
keyrand:
/* 80387608 0037D388  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 8038760C 0037D38C  2C 04 00 00 */	cmpwi r4, 0
/* 80387610 0037D390  93 E1 00 0C */	stw r31, 0xc(r1)
/* 80387614 0037D394  40 82 00 0C */	bne lbl_80387620
/* 80387618 0037D398  38 60 00 00 */	li r3, 0
/* 8038761C 0037D39C  48 00 00 88 */	b lbl_803876A4
lbl_80387620:
/* 80387620 0037D3A0  39 80 00 00 */	li r12, 0
/* 80387624 0037D3A4  3B E0 00 01 */	li r31, 1
/* 80387628 0037D3A8  48 00 00 0C */	b lbl_80387634
lbl_8038762C:
/* 8038762C 0037D3AC  57 E9 08 3C */	slwi r9, r31, 1
/* 80387630 0037D3B0  3B E9 00 01 */	addi r31, r9, 1
lbl_80387634:
/* 80387634 0037D3B4  7C 1F 20 40 */	cmplw r31, r4
/* 80387638 0037D3B8  41 80 FF F4 */	blt lbl_8038762C
/* 8038763C 0037D3BC  39 20 00 00 */	li r9, 0
lbl_80387640:
/* 80387640 0037D3C0  81 48 00 00 */	lwz r10, 0(r8)
/* 80387644 0037D3C4  89 67 00 00 */	lbz r11, 0(r7)
/* 80387648 0037D3C8  7C 05 50 AE */	lbzx r0, r5, r10
/* 8038764C 0037D3CC  39 4A 00 01 */	addi r10, r10, 1
/* 80387650 0037D3D0  7D 63 58 AE */	lbzx r11, r3, r11
/* 80387654 0037D3D4  7C 0A 30 40 */	cmplw r10, r6
/* 80387658 0037D3D8  7C 0B 02 14 */	add r0, r11, r0
/* 8038765C 0037D3DC  98 07 00 00 */	stb r0, 0(r7)
/* 80387660 0037D3E0  91 48 00 00 */	stw r10, 0(r8)
/* 80387664 0037D3E4  41 80 00 14 */	blt lbl_80387678
/* 80387668 0037D3E8  91 28 00 00 */	stw r9, 0(r8)
/* 8038766C 0037D3EC  88 07 00 00 */	lbz r0, 0(r7)
/* 80387670 0037D3F0  7C 00 32 14 */	add r0, r0, r6
/* 80387674 0037D3F4  98 07 00 00 */	stb r0, 0(r7)
lbl_80387678:
/* 80387678 0037D3F8  39 8C 00 01 */	addi r12, r12, 1
/* 8038767C 0037D3FC  88 07 00 00 */	lbz r0, 0(r7)
/* 80387680 0037D400  28 0C 00 0B */	cmplwi r12, 0xb
/* 80387684 0037D404  7F EA 00 38 */	and r10, r31, r0
/* 80387688 0037D408  40 81 00 10 */	ble lbl_80387698
/* 8038768C 0037D40C  7C 0A 23 96 */	divwu r0, r10, r4
/* 80387690 0037D410  7C 00 21 D6 */	mullw r0, r0, r4
/* 80387694 0037D414  7D 40 50 50 */	subf r10, r0, r10
lbl_80387698:
/* 80387698 0037D418  7C 0A 20 40 */	cmplw r10, r4
/* 8038769C 0037D41C  41 81 FF A4 */	bgt lbl_80387640
/* 803876A0 0037D420  55 43 06 3E */	clrlwi r3, r10, 0x18
lbl_803876A4:
/* 803876A4 0037D424  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 803876A8 0037D428  38 21 00 10 */	addi r1, r1, 0x10
/* 803876AC 0037D42C  4E 80 00 20 */	blr 

.global GOACryptInit
GOACryptInit:
/* 803876B0 0037D430  94 21 FF D0 */	stwu r1, -0x30(r1)
/* 803876B4 0037D434  7C 08 02 A6 */	mflr r0
/* 803876B8 0037D438  90 01 00 34 */	stw r0, 0x34(r1)
/* 803876BC 0037D43C  39 61 00 30 */	addi r11, r1, 0x30
/* 803876C0 0037D440  48 06 9C 61 */	bl _savegpr_27
/* 803876C4 0037D444  28 05 00 01 */	cmplwi r5, 1
/* 803876C8 0037D448  7C 7D 1B 78 */	mr r29, r3
/* 803876CC 0037D44C  7C 9E 23 78 */	mr r30, r4
/* 803876D0 0037D450  7C BF 2B 78 */	mr r31, r5
/* 803876D4 0037D454  40 80 00 D4 */	bge lbl_803877A8
/* 803876D8 0037D458  39 00 00 01 */	li r8, 1
/* 803876DC 0037D45C  38 E0 00 03 */	li r7, 3
/* 803876E0 0037D460  38 C0 00 05 */	li r6, 5
/* 803876E4 0037D464  38 A0 00 07 */	li r5, 7
/* 803876E8 0037D468  38 80 00 0B */	li r4, 0xb
/* 803876EC 0037D46C  38 00 00 10 */	li r0, 0x10
/* 803876F0 0037D470  99 03 01 00 */	stb r8, 0x100(r3)
/* 803876F4 0037D474  39 60 00 00 */	li r11, 0
/* 803876F8 0037D478  39 40 00 FF */	li r10, 0xff
/* 803876FC 0037D47C  98 E3 01 01 */	stb r7, 0x101(r3)
/* 80387700 0037D480  98 C3 01 02 */	stb r6, 0x102(r3)
/* 80387704 0037D484  98 A3 01 03 */	stb r5, 0x103(r3)
/* 80387708 0037D488  98 83 01 04 */	stb r4, 0x104(r3)
/* 8038770C 0037D48C  7C 09 03 A6 */	mtctr r0
lbl_80387710:
/* 80387710 0037D490  7D 43 59 AE */	stbx r10, r3, r11
/* 80387714 0037D494  7D 83 5A 14 */	add r12, r3, r11
/* 80387718 0037D498  39 2A FF FF */	addi r9, r10, -1
/* 8038771C 0037D49C  39 0A FF FE */	addi r8, r10, -2
/* 80387720 0037D4A0  99 2C 00 01 */	stb r9, 1(r12)
/* 80387724 0037D4A4  38 EA FF FD */	addi r7, r10, -3
/* 80387728 0037D4A8  38 CA FF FC */	addi r6, r10, -4
/* 8038772C 0037D4AC  38 AA FF FB */	addi r5, r10, -5
/* 80387730 0037D4B0  99 0C 00 02 */	stb r8, 2(r12)
/* 80387734 0037D4B4  38 8A FF FA */	addi r4, r10, -6
/* 80387738 0037D4B8  38 0A FF F9 */	addi r0, r10, -7
/* 8038773C 0037D4BC  39 2A FF F7 */	addi r9, r10, -9
/* 80387740 0037D4C0  98 EC 00 03 */	stb r7, 3(r12)
/* 80387744 0037D4C4  39 0A FF F6 */	addi r8, r10, -10
/* 80387748 0037D4C8  38 EA FF F5 */	addi r7, r10, -11
/* 8038774C 0037D4CC  39 6B 00 08 */	addi r11, r11, 8
/* 80387750 0037D4D0  98 CC 00 04 */	stb r6, 4(r12)
/* 80387754 0037D4D4  38 CA FF F4 */	addi r6, r10, -12
/* 80387758 0037D4D8  98 AC 00 05 */	stb r5, 5(r12)
/* 8038775C 0037D4DC  38 AA FF F3 */	addi r5, r10, -13
/* 80387760 0037D4E0  98 8C 00 06 */	stb r4, 6(r12)
/* 80387764 0037D4E4  38 8A FF F2 */	addi r4, r10, -14
/* 80387768 0037D4E8  98 0C 00 07 */	stb r0, 7(r12)
/* 8038776C 0037D4EC  38 0A FF F1 */	addi r0, r10, -15
/* 80387770 0037D4F0  39 4A FF F8 */	addi r10, r10, -8
/* 80387774 0037D4F4  7D 83 5A 14 */	add r12, r3, r11
/* 80387778 0037D4F8  7D 43 59 AE */	stbx r10, r3, r11
/* 8038777C 0037D4FC  39 6B 00 08 */	addi r11, r11, 8
/* 80387780 0037D500  39 4A FF F8 */	addi r10, r10, -8
/* 80387784 0037D504  99 2C 00 01 */	stb r9, 1(r12)
/* 80387788 0037D508  99 0C 00 02 */	stb r8, 2(r12)
/* 8038778C 0037D50C  98 EC 00 03 */	stb r7, 3(r12)
/* 80387790 0037D510  98 CC 00 04 */	stb r6, 4(r12)
/* 80387794 0037D514  98 AC 00 05 */	stb r5, 5(r12)
/* 80387798 0037D518  98 8C 00 06 */	stb r4, 6(r12)
/* 8038779C 0037D51C  98 0C 00 07 */	stb r0, 7(r12)
/* 803877A0 0037D520  42 00 FF 70 */	bdnz lbl_80387710
/* 803877A4 0037D524  48 00 01 A0 */	b lbl_80387944
lbl_803877A8:
/* 803877A8 0037D528  38 00 00 08 */	li r0, 8
/* 803877AC 0037D52C  39 60 00 00 */	li r11, 0
/* 803877B0 0037D530  7C 09 03 A6 */	mtctr r0
lbl_803877B4:
/* 803877B4 0037D534  7D 63 59 AE */	stbx r11, r3, r11
/* 803877B8 0037D538  7D 43 5A 14 */	add r10, r3, r11
/* 803877BC 0037D53C  39 2B 00 01 */	addi r9, r11, 1
/* 803877C0 0037D540  39 0B 00 02 */	addi r8, r11, 2
/* 803877C4 0037D544  99 2A 00 01 */	stb r9, 1(r10)
/* 803877C8 0037D548  38 EB 00 03 */	addi r7, r11, 3
/* 803877CC 0037D54C  38 CB 00 04 */	addi r6, r11, 4
/* 803877D0 0037D550  38 AB 00 05 */	addi r5, r11, 5
/* 803877D4 0037D554  99 0A 00 02 */	stb r8, 2(r10)
/* 803877D8 0037D558  38 8B 00 06 */	addi r4, r11, 6
/* 803877DC 0037D55C  38 0B 00 07 */	addi r0, r11, 7
/* 803877E0 0037D560  39 2B 00 09 */	addi r9, r11, 9
/* 803877E4 0037D564  98 EA 00 03 */	stb r7, 3(r10)
/* 803877E8 0037D568  39 0B 00 0A */	addi r8, r11, 0xa
/* 803877EC 0037D56C  38 EB 00 0B */	addi r7, r11, 0xb
/* 803877F0 0037D570  98 CA 00 04 */	stb r6, 4(r10)
/* 803877F4 0037D574  38 CB 00 0C */	addi r6, r11, 0xc
/* 803877F8 0037D578  98 AA 00 05 */	stb r5, 5(r10)
/* 803877FC 0037D57C  38 AB 00 0D */	addi r5, r11, 0xd
/* 80387800 0037D580  98 8A 00 06 */	stb r4, 6(r10)
/* 80387804 0037D584  38 8B 00 0E */	addi r4, r11, 0xe
/* 80387808 0037D588  39 6B 00 08 */	addi r11, r11, 8
/* 8038780C 0037D58C  98 0A 00 07 */	stb r0, 7(r10)
/* 80387810 0037D590  7D 43 5A 14 */	add r10, r3, r11
/* 80387814 0037D594  38 0B 00 07 */	addi r0, r11, 7
/* 80387818 0037D598  7D 63 59 AE */	stbx r11, r3, r11
/* 8038781C 0037D59C  99 2A 00 01 */	stb r9, 1(r10)
/* 80387820 0037D5A0  39 2B 00 09 */	addi r9, r11, 9
/* 80387824 0037D5A4  99 0A 00 02 */	stb r8, 2(r10)
/* 80387828 0037D5A8  39 0B 00 0A */	addi r8, r11, 0xa
/* 8038782C 0037D5AC  98 EA 00 03 */	stb r7, 3(r10)
/* 80387830 0037D5B0  38 EB 00 0B */	addi r7, r11, 0xb
/* 80387834 0037D5B4  98 CA 00 04 */	stb r6, 4(r10)
/* 80387838 0037D5B8  38 CB 00 0C */	addi r6, r11, 0xc
/* 8038783C 0037D5BC  98 AA 00 05 */	stb r5, 5(r10)
/* 80387840 0037D5C0  38 AB 00 0D */	addi r5, r11, 0xd
/* 80387844 0037D5C4  98 8A 00 06 */	stb r4, 6(r10)
/* 80387848 0037D5C8  38 8B 00 0E */	addi r4, r11, 0xe
/* 8038784C 0037D5CC  39 6B 00 08 */	addi r11, r11, 8
/* 80387850 0037D5D0  98 0A 00 07 */	stb r0, 7(r10)
/* 80387854 0037D5D4  7D 43 5A 14 */	add r10, r3, r11
/* 80387858 0037D5D8  38 0B 00 07 */	addi r0, r11, 7
/* 8038785C 0037D5DC  7D 63 59 AE */	stbx r11, r3, r11
/* 80387860 0037D5E0  99 2A 00 01 */	stb r9, 1(r10)
/* 80387864 0037D5E4  39 2B 00 09 */	addi r9, r11, 9
/* 80387868 0037D5E8  99 0A 00 02 */	stb r8, 2(r10)
/* 8038786C 0037D5EC  39 0B 00 0A */	addi r8, r11, 0xa
/* 80387870 0037D5F0  98 EA 00 03 */	stb r7, 3(r10)
/* 80387874 0037D5F4  38 EB 00 0B */	addi r7, r11, 0xb
/* 80387878 0037D5F8  98 CA 00 04 */	stb r6, 4(r10)
/* 8038787C 0037D5FC  38 CB 00 0C */	addi r6, r11, 0xc
/* 80387880 0037D600  98 AA 00 05 */	stb r5, 5(r10)
/* 80387884 0037D604  38 AB 00 0D */	addi r5, r11, 0xd
/* 80387888 0037D608  98 8A 00 06 */	stb r4, 6(r10)
/* 8038788C 0037D60C  38 8B 00 0E */	addi r4, r11, 0xe
/* 80387890 0037D610  39 6B 00 08 */	addi r11, r11, 8
/* 80387894 0037D614  98 0A 00 07 */	stb r0, 7(r10)
/* 80387898 0037D618  7D 43 5A 14 */	add r10, r3, r11
/* 8038789C 0037D61C  38 0B 00 07 */	addi r0, r11, 7
/* 803878A0 0037D620  7D 63 59 AE */	stbx r11, r3, r11
/* 803878A4 0037D624  39 6B 00 08 */	addi r11, r11, 8
/* 803878A8 0037D628  99 2A 00 01 */	stb r9, 1(r10)
/* 803878AC 0037D62C  99 0A 00 02 */	stb r8, 2(r10)
/* 803878B0 0037D630  98 EA 00 03 */	stb r7, 3(r10)
/* 803878B4 0037D634  98 CA 00 04 */	stb r6, 4(r10)
/* 803878B8 0037D638  98 AA 00 05 */	stb r5, 5(r10)
/* 803878BC 0037D63C  98 8A 00 06 */	stb r4, 6(r10)
/* 803878C0 0037D640  98 0A 00 07 */	stb r0, 7(r10)
/* 803878C4 0037D644  42 00 FE F0 */	bdnz lbl_803877B4
/* 803878C8 0037D648  38 00 00 00 */	li r0, 0
/* 803878CC 0037D64C  3B 83 00 FF */	addi r28, r3, 0xff
/* 803878D0 0037D650  90 01 00 0C */	stw r0, 0xc(r1)
/* 803878D4 0037D654  3B 60 00 FF */	li r27, 0xff
/* 803878D8 0037D658  98 01 00 08 */	stb r0, 8(r1)
lbl_803878DC:
/* 803878DC 0037D65C  7F A3 EB 78 */	mr r3, r29
/* 803878E0 0037D660  7F 64 DB 78 */	mr r4, r27
/* 803878E4 0037D664  7F C5 F3 78 */	mr r5, r30
/* 803878E8 0037D668  7F E6 FB 78 */	mr r6, r31
/* 803878EC 0037D66C  38 E1 00 08 */	addi r7, r1, 8
/* 803878F0 0037D670  39 01 00 0C */	addi r8, r1, 0xc
/* 803878F4 0037D674  4B FF FD 15 */	bl keyrand
/* 803878F8 0037D678  54 63 06 3E */	clrlwi r3, r3, 0x18
/* 803878FC 0037D67C  88 9C 00 00 */	lbz r4, 0(r28)
/* 80387900 0037D680  7C 1D 18 AE */	lbzx r0, r29, r3
/* 80387904 0037D684  37 7B FF FF */	addic. r27, r27, -1
/* 80387908 0037D688  98 1C 00 00 */	stb r0, 0(r28)
/* 8038790C 0037D68C  3B 9C FF FF */	addi r28, r28, -1
/* 80387910 0037D690  7C 9D 19 AE */	stbx r4, r29, r3
/* 80387914 0037D694  40 80 FF C8 */	bge lbl_803878DC
/* 80387918 0037D698  88 BD 00 01 */	lbz r5, 1(r29)
/* 8038791C 0037D69C  88 9D 00 03 */	lbz r4, 3(r29)
/* 80387920 0037D6A0  88 7D 00 05 */	lbz r3, 5(r29)
/* 80387924 0037D6A4  88 1D 00 07 */	lbz r0, 7(r29)
/* 80387928 0037D6A8  98 BD 01 00 */	stb r5, 0x100(r29)
/* 8038792C 0037D6AC  98 9D 01 01 */	stb r4, 0x101(r29)
/* 80387930 0037D6B0  98 7D 01 02 */	stb r3, 0x102(r29)
/* 80387934 0037D6B4  98 1D 01 03 */	stb r0, 0x103(r29)
/* 80387938 0037D6B8  88 01 00 08 */	lbz r0, 8(r1)
/* 8038793C 0037D6BC  7C 1D 00 AE */	lbzx r0, r29, r0
/* 80387940 0037D6C0  98 1D 01 04 */	stb r0, 0x104(r29)
lbl_80387944:
/* 80387944 0037D6C4  39 61 00 30 */	addi r11, r1, 0x30
/* 80387948 0037D6C8  48 06 9A 25 */	bl _restgpr_27
/* 8038794C 0037D6CC  80 01 00 34 */	lwz r0, 0x34(r1)
/* 80387950 0037D6D0  7C 08 03 A6 */	mtlr r0
/* 80387954 0037D6D4  38 21 00 30 */	addi r1, r1, 0x30
/* 80387958 0037D6D8  4E 80 00 20 */	blr 

.global GOADecrypt
GOADecrypt:
/* 8038795C 0037D6DC  7C A9 03 A6 */	mtctr r5
/* 80387960 0037D6E0  2C 05 00 00 */	cmpwi r5, 0
/* 80387964 0037D6E4  4C 81 00 20 */	blelr 
lbl_80387968:
/* 80387968 0037D6E8  88 C3 01 00 */	lbz r6, 0x100(r3)
/* 8038796C 0037D6EC  89 03 01 01 */	lbz r8, 0x101(r3)
/* 80387970 0037D6F0  7C A3 30 AE */	lbzx r5, r3, r6
/* 80387974 0037D6F4  38 E6 00 01 */	addi r7, r6, 1
/* 80387978 0037D6F8  88 04 00 00 */	lbz r0, 0(r4)
/* 8038797C 0037D6FC  7C A8 2A 14 */	add r5, r8, r5
/* 80387980 0037D700  88 C3 01 04 */	lbz r6, 0x104(r3)
/* 80387984 0037D704  98 A3 01 01 */	stb r5, 0x101(r3)
/* 80387988 0037D708  54 A5 06 3E */	clrlwi r5, r5, 0x18
/* 8038798C 0037D70C  98 E3 01 00 */	stb r7, 0x100(r3)
/* 80387990 0037D710  7C E3 30 AE */	lbzx r7, r3, r6
/* 80387994 0037D714  7C A3 28 AE */	lbzx r5, r3, r5
/* 80387998 0037D718  7C A3 31 AE */	stbx r5, r3, r6
/* 8038799C 0037D71C  88 C3 01 03 */	lbz r6, 0x103(r3)
/* 803879A0 0037D720  88 A3 01 01 */	lbz r5, 0x101(r3)
/* 803879A4 0037D724  7C C3 30 AE */	lbzx r6, r3, r6
/* 803879A8 0037D728  7C C3 29 AE */	stbx r6, r3, r5
/* 803879AC 0037D72C  88 C3 01 00 */	lbz r6, 0x100(r3)
/* 803879B0 0037D730  88 A3 01 03 */	lbz r5, 0x103(r3)
/* 803879B4 0037D734  7C C3 30 AE */	lbzx r6, r3, r6
/* 803879B8 0037D738  7C C3 29 AE */	stbx r6, r3, r5
/* 803879BC 0037D73C  88 A3 01 00 */	lbz r5, 0x100(r3)
/* 803879C0 0037D740  7C E3 29 AE */	stbx r7, r3, r5
/* 803879C4 0037D744  7C A3 38 AE */	lbzx r5, r3, r7
/* 803879C8 0037D748  88 C3 01 02 */	lbz r6, 0x102(r3)
/* 803879CC 0037D74C  88 E3 01 01 */	lbz r7, 0x101(r3)
/* 803879D0 0037D750  7C A6 2A 14 */	add r5, r6, r5
/* 803879D4 0037D754  88 C3 01 03 */	lbz r6, 0x103(r3)
/* 803879D8 0037D758  98 A3 01 02 */	stb r5, 0x102(r3)
/* 803879DC 0037D75C  54 AA 06 3E */	clrlwi r10, r5, 0x18
/* 803879E0 0037D760  88 A3 01 04 */	lbz r5, 0x104(r3)
/* 803879E4 0037D764  7D 03 38 AE */	lbzx r8, r3, r7
/* 803879E8 0037D768  7C E3 30 AE */	lbzx r7, r3, r6
/* 803879EC 0037D76C  7C C3 28 AE */	lbzx r6, r3, r5
/* 803879F0 0037D770  7C A8 3A 14 */	add r5, r8, r7
/* 803879F4 0037D774  89 23 01 00 */	lbz r9, 0x100(r3)
/* 803879F8 0037D778  7C A6 2A 14 */	add r5, r6, r5
/* 803879FC 0037D77C  7D 03 50 AE */	lbzx r8, r3, r10
/* 80387A00 0037D780  7C E3 48 AE */	lbzx r7, r3, r9
/* 80387A04 0037D784  54 A5 06 3E */	clrlwi r5, r5, 0x18
/* 80387A08 0037D788  7C A3 28 AE */	lbzx r5, r3, r5
/* 80387A0C 0037D78C  7C C8 3A 14 */	add r6, r8, r7
/* 80387A10 0037D790  54 C6 06 3E */	clrlwi r6, r6, 0x18
/* 80387A14 0037D794  7C A3 28 AE */	lbzx r5, r3, r5
/* 80387A18 0037D798  7C C3 30 AE */	lbzx r6, r3, r6
/* 80387A1C 0037D79C  7C 06 32 78 */	xor r6, r0, r6
/* 80387A20 0037D7A0  98 03 01 04 */	stb r0, 0x104(r3)
/* 80387A24 0037D7A4  7C C5 2A 78 */	xor r5, r6, r5
/* 80387A28 0037D7A8  98 A3 01 03 */	stb r5, 0x103(r3)
/* 80387A2C 0037D7AC  98 A4 00 00 */	stb r5, 0(r4)
/* 80387A30 0037D7B0  38 84 00 01 */	addi r4, r4, 1
/* 80387A34 0037D7B4  42 00 FF 34 */	bdnz lbl_80387968
/* 80387A38 0037D7B8  4E 80 00 20 */	blr 

