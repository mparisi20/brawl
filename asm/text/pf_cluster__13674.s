.include "macros.inc"

.section .text, "ax"  # 0x8000C860 - 0x804064E0

.global PFCLUSTER_UpdateLastAccessCluster
PFCLUSTER_UpdateLastAccessCluster:
/* 803DAAE8 003D0868  80 C3 00 1C */	lwz r6, 0x1c(r3)
/* 803DAAEC 003D086C  2C 06 00 00 */	cmpwi r6, 0
/* 803DAAF0 003D0870  40 82 00 1C */	bne lbl_803DAB0C
/* 803DAAF4 003D0874  80 83 00 08 */	lwz r4, 8(r3)
/* 803DAAF8 003D0878  38 00 00 00 */	li r0, 0
/* 803DAAFC 003D087C  90 04 00 1C */	stw r0, 0x1c(r4)
/* 803DAB00 003D0880  80 63 00 08 */	lwz r3, 8(r3)
/* 803DAB04 003D0884  90 03 00 18 */	stw r0, 0x18(r3)
/* 803DAB08 003D0888  4E 80 00 20 */	blr 
lbl_803DAB0C:
/* 803DAB0C 003D088C  2C 03 00 00 */	cmpwi r3, 0
/* 803DAB10 003D0890  40 82 00 0C */	bne lbl_803DAB1C
/* 803DAB14 003D0894  38 E0 00 00 */	li r7, 0
/* 803DAB18 003D0898  48 00 00 0C */	b lbl_803DAB24
lbl_803DAB1C:
/* 803DAB1C 003D089C  80 A3 00 08 */	lwz r5, 8(r3)
/* 803DAB20 003D08A0  80 E5 02 68 */	lwz r7, 0x268(r5)
lbl_803DAB24:
/* 803DAB24 003D08A4  A0 A7 00 00 */	lhz r5, 0(r7)
/* 803DAB28 003D08A8  38 05 FF FF */	addi r0, r5, -1
/* 803DAB2C 003D08AC  7C C0 00 39 */	and. r0, r6, r0
/* 803DAB30 003D08B0  40 82 00 58 */	bne lbl_803DAB88
/* 803DAB34 003D08B4  88 A7 00 06 */	lbz r5, 6(r7)
/* 803DAB38 003D08B8  80 C3 00 24 */	lwz r6, 0x24(r3)
/* 803DAB3C 003D08BC  38 05 FF FF */	addi r0, r5, -1
/* 803DAB40 003D08C0  7C C0 00 39 */	and. r0, r6, r0
/* 803DAB44 003D08C4  40 82 00 44 */	bne lbl_803DAB88
/* 803DAB48 003D08C8  2C 06 00 00 */	cmpwi r6, 0
/* 803DAB4C 003D08CC  4D 82 00 20 */	beqlr 
/* 803DAB50 003D08D0  88 07 00 21 */	lbz r0, 0x21(r7)
/* 803DAB54 003D08D4  38 C6 FF FF */	addi r6, r6, -1
/* 803DAB58 003D08D8  80 A3 00 08 */	lwz r5, 8(r3)
/* 803DAB5C 003D08DC  38 84 FF FF */	addi r4, r4, -1
/* 803DAB60 003D08E0  7C C0 04 30 */	srw r0, r6, r0
/* 803DAB64 003D08E4  90 05 00 18 */	stw r0, 0x18(r5)
/* 803DAB68 003D08E8  80 A7 00 30 */	lwz r5, 0x30(r7)
/* 803DAB6C 003D08EC  88 07 00 21 */	lbz r0, 0x21(r7)
/* 803DAB70 003D08F0  7C 85 20 50 */	subf r4, r5, r4
/* 803DAB74 003D08F4  80 63 00 08 */	lwz r3, 8(r3)
/* 803DAB78 003D08F8  7C 84 04 30 */	srw r4, r4, r0
/* 803DAB7C 003D08FC  38 04 00 02 */	addi r0, r4, 2
/* 803DAB80 003D0900  90 03 00 1C */	stw r0, 0x1c(r3)
/* 803DAB84 003D0904  4E 80 00 20 */	blr 
lbl_803DAB88:
/* 803DAB88 003D0908  80 C3 00 24 */	lwz r6, 0x24(r3)
/* 803DAB8C 003D090C  88 07 00 21 */	lbz r0, 0x21(r7)
/* 803DAB90 003D0910  80 A3 00 08 */	lwz r5, 8(r3)
/* 803DAB94 003D0914  7C C0 04 30 */	srw r0, r6, r0
/* 803DAB98 003D0918  90 05 00 18 */	stw r0, 0x18(r5)
/* 803DAB9C 003D091C  80 A7 00 30 */	lwz r5, 0x30(r7)
/* 803DABA0 003D0920  88 07 00 21 */	lbz r0, 0x21(r7)
/* 803DABA4 003D0924  7C 85 20 50 */	subf r4, r5, r4
/* 803DABA8 003D0928  80 63 00 08 */	lwz r3, 8(r3)
/* 803DABAC 003D092C  7C 84 04 30 */	srw r4, r4, r0
/* 803DABB0 003D0930  38 04 00 02 */	addi r0, r4, 2
/* 803DABB4 003D0934  90 03 00 1C */	stw r0, 0x1c(r3)
/* 803DABB8 003D0938  4E 80 00 20 */	blr 

.global PFCLUSTER_AppendCluster
PFCLUSTER_AppendCluster:
/* 803DABBC 003D093C  94 21 FF C0 */	stwu r1, -0x40(r1)
/* 803DABC0 003D0940  7C 08 02 A6 */	mflr r0
/* 803DABC4 003D0944  90 01 00 44 */	stw r0, 0x44(r1)
/* 803DABC8 003D0948  38 00 00 00 */	li r0, 0
/* 803DABCC 003D094C  93 E1 00 3C */	stw r31, 0x3c(r1)
/* 803DABD0 003D0950  93 C1 00 38 */	stw r30, 0x38(r1)
/* 803DABD4 003D0954  7C BE 2B 78 */	mr r30, r5
/* 803DABD8 003D0958  93 A1 00 34 */	stw r29, 0x34(r1)
/* 803DABDC 003D095C  7C 9D 23 78 */	mr r29, r4
/* 803DABE0 003D0960  93 81 00 30 */	stw r28, 0x30(r1)
/* 803DABE4 003D0964  7C 7C 1B 78 */	mr r28, r3
/* 803DABE8 003D0968  90 05 00 00 */	stw r0, 0(r5)
/* 803DABEC 003D096C  81 83 00 08 */	lwz r12, 8(r3)
/* 803DABF0 003D0970  80 AC 00 00 */	lwz r5, 0(r12)
/* 803DABF4 003D0974  54 A0 07 FF */	clrlwi. r0, r5, 0x1f
/* 803DABF8 003D0978  41 82 00 0C */	beq lbl_803DAC04
/* 803DABFC 003D097C  54 A0 07 BD */	rlwinm. r0, r5, 0, 0x1e, 0x1e
/* 803DAC00 003D0980  40 82 00 0C */	bne lbl_803DAC0C
lbl_803DAC04:
/* 803DAC04 003D0984  38 60 00 26 */	li r3, 0x26
/* 803DAC08 003D0988  48 00 01 C4 */	b lbl_803DADCC
lbl_803DAC0C:
/* 803DAC0C 003D098C  2C 03 00 00 */	cmpwi r3, 0
/* 803DAC10 003D0990  40 82 00 0C */	bne lbl_803DAC1C
/* 803DAC14 003D0994  3B E0 00 00 */	li r31, 0
/* 803DAC18 003D0998  48 00 00 08 */	b lbl_803DAC20
lbl_803DAC1C:
/* 803DAC1C 003D099C  83 EC 02 68 */	lwz r31, 0x268(r12)
lbl_803DAC20:
/* 803DAC20 003D09A0  81 63 00 1C */	lwz r11, 0x1c(r3)
/* 803DAC24 003D09A4  38 A3 00 0C */	addi r5, r3, 0xc
/* 803DAC28 003D09A8  81 43 00 20 */	lwz r10, 0x20(r3)
/* 803DAC2C 003D09AC  38 00 FF FF */	li r0, -1
/* 803DAC30 003D09B0  81 23 00 24 */	lwz r9, 0x24(r3)
/* 803DAC34 003D09B4  81 03 00 28 */	lwz r8, 0x28(r3)
/* 803DAC38 003D09B8  80 E3 00 0C */	lwz r7, 0xc(r3)
/* 803DAC3C 003D09BC  80 C3 00 10 */	lwz r6, 0x10(r3)
/* 803DAC40 003D09C0  80 63 00 14 */	lwz r3, 0x14(r3)
/* 803DAC44 003D09C4  91 61 00 20 */	stw r11, 0x20(r1)
/* 803DAC48 003D09C8  90 AC 00 34 */	stw r5, 0x34(r12)
/* 803DAC4C 003D09CC  90 01 00 0C */	stw r0, 0xc(r1)
/* 803DAC50 003D09D0  A0 1F 1F AC */	lhz r0, 0x1fac(r31)
/* 803DAC54 003D09D4  91 41 00 24 */	stw r10, 0x24(r1)
/* 803DAC58 003D09D8  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 803DAC5C 003D09DC  91 21 00 28 */	stw r9, 0x28(r1)
/* 803DAC60 003D09E0  91 01 00 2C */	stw r8, 0x2c(r1)
/* 803DAC64 003D09E4  90 E1 00 10 */	stw r7, 0x10(r1)
/* 803DAC68 003D09E8  90 C1 00 14 */	stw r6, 0x14(r1)
/* 803DAC6C 003D09EC  90 61 00 18 */	stw r3, 0x18(r1)
/* 803DAC70 003D09F0  41 82 00 24 */	beq lbl_803DAC94
/* 803DAC74 003D09F4  80 7F 00 38 */	lwz r3, 0x38(r31)
/* 803DAC78 003D09F8  3C 03 00 01 */	addis r0, r3, 1
/* 803DAC7C 003D09FC  28 00 FF FF */	cmplwi r0, 0xffff
/* 803DAC80 003D0A00  41 82 00 14 */	beq lbl_803DAC94
/* 803DAC84 003D0A04  2C 03 00 00 */	cmpwi r3, 0
/* 803DAC88 003D0A08  40 82 00 0C */	bne lbl_803DAC94
/* 803DAC8C 003D0A0C  38 60 00 06 */	li r3, 6
/* 803DAC90 003D0A10  48 00 01 3C */	b lbl_803DADCC
lbl_803DAC94:
/* 803DAC94 003D0A14  80 BC 00 08 */	lwz r5, 8(r28)
/* 803DAC98 003D0A18  7F 83 E3 78 */	mr r3, r28
/* 803DAC9C 003D0A1C  80 05 02 64 */	lwz r0, 0x264(r5)
/* 803DACA0 003D0A20  7C 80 22 14 */	add r4, r0, r4
/* 803DACA4 003D0A24  48 00 9A 09 */	bl PFFILE_Cursor_MoveToClusterEnd
/* 803DACA8 003D0A28  80 7C 00 1C */	lwz r3, 0x1c(r28)
/* 803DACAC 003D0A2C  3C 03 00 01 */	addis r0, r3, 1
/* 803DACB0 003D0A30  28 00 FF FF */	cmplwi r0, 0xffff
/* 803DACB4 003D0A34  40 82 00 14 */	bne lbl_803DACC8
/* 803DACB8 003D0A38  38 00 00 00 */	li r0, 0
/* 803DACBC 003D0A3C  38 60 00 25 */	li r3, 0x25
/* 803DACC0 003D0A40  90 1E 00 00 */	stw r0, 0(r30)
/* 803DACC4 003D0A44  48 00 01 08 */	b lbl_803DADCC
lbl_803DACC8:
/* 803DACC8 003D0A48  80 7C 00 08 */	lwz r3, 8(r28)
/* 803DACCC 003D0A4C  7F A5 EB 78 */	mr r5, r29
/* 803DACD0 003D0A50  80 9C 00 24 */	lwz r4, 0x24(r28)
/* 803DACD4 003D0A54  38 C1 00 0C */	addi r6, r1, 0xc
/* 803DACD8 003D0A58  38 63 00 04 */	addi r3, r3, 4
/* 803DACDC 003D0A5C  48 00 67 7D */	bl PFFAT_GetSectorAllocated
/* 803DACE0 003D0A60  2C 03 00 00 */	cmpwi r3, 0
/* 803DACE4 003D0A64  41 82 00 40 */	beq lbl_803DAD24
/* 803DACE8 003D0A68  81 21 00 20 */	lwz r9, 0x20(r1)
/* 803DACEC 003D0A6C  81 01 00 24 */	lwz r8, 0x24(r1)
/* 803DACF0 003D0A70  80 E1 00 28 */	lwz r7, 0x28(r1)
/* 803DACF4 003D0A74  80 C1 00 2C */	lwz r6, 0x2c(r1)
/* 803DACF8 003D0A78  80 A1 00 10 */	lwz r5, 0x10(r1)
/* 803DACFC 003D0A7C  80 81 00 14 */	lwz r4, 0x14(r1)
/* 803DAD00 003D0A80  80 01 00 18 */	lwz r0, 0x18(r1)
/* 803DAD04 003D0A84  91 3C 00 1C */	stw r9, 0x1c(r28)
/* 803DAD08 003D0A88  91 1C 00 20 */	stw r8, 0x20(r28)
/* 803DAD0C 003D0A8C  90 FC 00 24 */	stw r7, 0x24(r28)
/* 803DAD10 003D0A90  90 DC 00 28 */	stw r6, 0x28(r28)
/* 803DAD14 003D0A94  90 BC 00 0C */	stw r5, 0xc(r28)
/* 803DAD18 003D0A98  90 9C 00 10 */	stw r4, 0x10(r28)
/* 803DAD1C 003D0A9C  90 1C 00 14 */	stw r0, 0x14(r28)
/* 803DAD20 003D0AA0  48 00 00 AC */	b lbl_803DADCC
lbl_803DAD24:
/* 803DAD24 003D0AA4  38 00 00 00 */	li r0, 0
/* 803DAD28 003D0AA8  7F A5 EB 78 */	mr r5, r29
/* 803DAD2C 003D0AAC  90 01 00 08 */	stw r0, 8(r1)
/* 803DAD30 003D0AB0  38 C1 00 0C */	addi r6, r1, 0xc
/* 803DAD34 003D0AB4  38 E1 00 08 */	addi r7, r1, 8
/* 803DAD38 003D0AB8  80 7C 00 08 */	lwz r3, 8(r28)
/* 803DAD3C 003D0ABC  80 9C 00 24 */	lwz r4, 0x24(r28)
/* 803DAD40 003D0AC0  38 63 00 04 */	addi r3, r3, 4
/* 803DAD44 003D0AC4  48 00 67 51 */	bl PFFAT_getContinuousSector
/* 803DAD48 003D0AC8  81 21 00 20 */	lwz r9, 0x20(r1)
/* 803DAD4C 003D0ACC  2C 03 00 00 */	cmpwi r3, 0
/* 803DAD50 003D0AD0  81 01 00 24 */	lwz r8, 0x24(r1)
/* 803DAD54 003D0AD4  80 E1 00 28 */	lwz r7, 0x28(r1)
/* 803DAD58 003D0AD8  80 C1 00 2C */	lwz r6, 0x2c(r1)
/* 803DAD5C 003D0ADC  80 A1 00 10 */	lwz r5, 0x10(r1)
/* 803DAD60 003D0AE0  80 81 00 14 */	lwz r4, 0x14(r1)
/* 803DAD64 003D0AE4  80 01 00 18 */	lwz r0, 0x18(r1)
/* 803DAD68 003D0AE8  91 3C 00 1C */	stw r9, 0x1c(r28)
/* 803DAD6C 003D0AEC  91 1C 00 20 */	stw r8, 0x20(r28)
/* 803DAD70 003D0AF0  90 FC 00 24 */	stw r7, 0x24(r28)
/* 803DAD74 003D0AF4  90 DC 00 28 */	stw r6, 0x28(r28)
/* 803DAD78 003D0AF8  90 BC 00 0C */	stw r5, 0xc(r28)
/* 803DAD7C 003D0AFC  90 9C 00 10 */	stw r4, 0x10(r28)
/* 803DAD80 003D0B00  90 1C 00 14 */	stw r0, 0x14(r28)
/* 803DAD84 003D0B04  41 82 00 08 */	beq lbl_803DAD8C
/* 803DAD88 003D0B08  48 00 00 44 */	b lbl_803DADCC
lbl_803DAD8C:
/* 803DAD8C 003D0B0C  80 61 00 0C */	lwz r3, 0xc(r1)
/* 803DAD90 003D0B10  3C 03 00 01 */	addis r0, r3, 1
/* 803DAD94 003D0B14  28 00 FF FF */	cmplwi r0, 0xffff
/* 803DAD98 003D0B18  40 82 00 14 */	bne lbl_803DADAC
/* 803DAD9C 003D0B1C  7F 83 E3 78 */	mr r3, r28
/* 803DADA0 003D0B20  48 00 98 C9 */	bl PFFILE_Cursor_MoveToEnd
/* 803DADA4 003D0B24  38 60 00 1C */	li r3, 0x1c
/* 803DADA8 003D0B28  48 00 00 24 */	b lbl_803DADCC
lbl_803DADAC:
/* 803DADAC 003D0B2C  80 61 00 08 */	lwz r3, 8(r1)
/* 803DADB0 003D0B30  88 1F 00 20 */	lbz r0, 0x20(r31)
/* 803DADB4 003D0B34  7C 60 00 30 */	slw r0, r3, r0
/* 803DADB8 003D0B38  7C 1D 00 40 */	cmplw r29, r0
/* 803DADBC 003D0B3C  40 80 00 08 */	bge lbl_803DADC4
/* 803DADC0 003D0B40  7F A0 EB 78 */	mr r0, r29
lbl_803DADC4:
/* 803DADC4 003D0B44  90 1E 00 00 */	stw r0, 0(r30)
/* 803DADC8 003D0B48  38 60 00 00 */	li r3, 0
lbl_803DADCC:
/* 803DADCC 003D0B4C  80 01 00 44 */	lwz r0, 0x44(r1)
/* 803DADD0 003D0B50  83 E1 00 3C */	lwz r31, 0x3c(r1)
/* 803DADD4 003D0B54  83 C1 00 38 */	lwz r30, 0x38(r1)
/* 803DADD8 003D0B58  83 A1 00 34 */	lwz r29, 0x34(r1)
/* 803DADDC 003D0B5C  83 81 00 30 */	lwz r28, 0x30(r1)
/* 803DADE0 003D0B60  7C 08 03 A6 */	mtlr r0
/* 803DADE4 003D0B64  38 21 00 40 */	addi r1, r1, 0x40
/* 803DADE8 003D0B68  4E 80 00 20 */	blr 

