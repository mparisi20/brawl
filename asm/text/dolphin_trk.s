.include "macros.inc"

.section .text, "ax"  # 0x8000C860 - 0x804064E0

.global InitMetroTRK
InitMetroTRK:
/* 80405698 003FB418  38 21 FF FC */	addi r1, r1, -4
/* 8040569C 003FB41C  90 61 00 00 */	stw r3, 0(r1)
/* 804056A0 003FB420  3C 60 80 59 */	lis r3, lbl_8059B9F0@h
/* 804056A4 003FB424  60 63 B9 F0 */	ori r3, r3, lbl_8059B9F0@l
/* 804056A8 003FB428  BC 03 00 00 */	stmw r0, 0(r3)
/* 804056AC 003FB42C  80 81 00 00 */	lwz r4, 0(r1)
/* 804056B0 003FB430  38 21 00 04 */	addi r1, r1, 4
/* 804056B4 003FB434  90 23 00 04 */	stw r1, 4(r3)
/* 804056B8 003FB438  90 83 00 0C */	stw r4, 0xc(r3)
/* 804056BC 003FB43C  7C 88 02 A6 */	mflr r4
/* 804056C0 003FB440  90 83 00 84 */	stw r4, 0x84(r3)
/* 804056C4 003FB444  90 83 00 80 */	stw r4, 0x80(r3)
/* 804056C8 003FB448  7C 80 00 26 */	mfcr r4
/* 804056CC 003FB44C  90 83 00 88 */	stw r4, 0x88(r3)
/* 804056D0 003FB450  7C 80 00 A6 */	mfmsr r4
/* 804056D4 003FB454  60 83 80 00 */	ori r3, r4, 0x8000
/* 804056D8 003FB458  68 63 80 00 */	xori r3, r3, 0x8000
/* 804056DC 003FB45C  7C 60 01 24 */	mtmsr r3
/* 804056E0 003FB460  7C 9B 03 A6 */	mtspr 0x1b, r4
/* 804056E4 003FB464  4B FF FA CD */	bl TRKSaveExtended1Block
/* 804056E8 003FB468  3C 60 80 59 */	lis r3, lbl_8059B9F0@h
/* 804056EC 003FB46C  60 63 B9 F0 */	ori r3, r3, lbl_8059B9F0@l
/* 804056F0 003FB470  B8 03 00 00 */	.4byte 0xB8030000  /* illegal lmw r0, 0(r3) */
/* 804056F4 003FB474  38 00 00 00 */	li r0, 0
/* 804056F8 003FB478  7C 12 FB A6 */	mtspr 0x3f2, r0
/* 804056FC 003FB47C  7C 15 FB A6 */	mtspr 0x3f5, r0
/* 80405700 003FB480  3C 20 80 5B */	lis r1, 0x805B7158@h
/* 80405704 003FB484  60 21 71 58 */	ori r1, r1, 0x805B7158@l
/* 80405708 003FB488  7C A3 2B 78 */	mr r3, r5
/* 8040570C 003FB48C  48 00 05 A1 */	bl InitMetroTRKCommTable
/* 80405710 003FB490  2C 03 00 01 */	cmpwi r3, 1
/* 80405714 003FB494  40 82 00 14 */	bne lbl_80405728
/* 80405718 003FB498  80 83 00 84 */	lwz r4, 0x84(r3)
/* 8040571C 003FB49C  7C 88 03 A6 */	mtlr r4
/* 80405720 003FB4A0  B8 03 00 00 */	.4byte 0xB8030000  /* illegal lmw r0, 0(r3) */
/* 80405724 003FB4A4  4E 80 00 20 */	blr 
lbl_80405728:
/* 80405728 003FB4A8  48 00 02 8C */	b TRK_main
/* 8040572C 003FB4AC  4E 80 00 20 */	blr 

.global InitMetroTRK_BBA
InitMetroTRK_BBA:
/* 80405730 003FB4B0  38 21 FF FC */	addi r1, r1, -4
/* 80405734 003FB4B4  90 61 00 00 */	stw r3, 0(r1)
/* 80405738 003FB4B8  3C 60 80 59 */	lis r3, lbl_8059B9F0@h
/* 8040573C 003FB4BC  60 63 B9 F0 */	ori r3, r3, lbl_8059B9F0@l
/* 80405740 003FB4C0  BC 03 00 00 */	stmw r0, 0(r3)
/* 80405744 003FB4C4  80 81 00 00 */	lwz r4, 0(r1)
/* 80405748 003FB4C8  38 21 00 04 */	addi r1, r1, 4
/* 8040574C 003FB4CC  90 23 00 04 */	stw r1, 4(r3)
/* 80405750 003FB4D0  90 83 00 0C */	stw r4, 0xc(r3)
/* 80405754 003FB4D4  7C 88 02 A6 */	mflr r4
/* 80405758 003FB4D8  90 83 00 84 */	stw r4, 0x84(r3)
/* 8040575C 003FB4DC  90 83 00 80 */	stw r4, 0x80(r3)
/* 80405760 003FB4E0  7C 80 00 26 */	mfcr r4
/* 80405764 003FB4E4  90 83 00 88 */	stw r4, 0x88(r3)
/* 80405768 003FB4E8  7C 80 00 A6 */	mfmsr r4
/* 8040576C 003FB4EC  60 83 80 00 */	ori r3, r4, 0x8000
/* 80405770 003FB4F0  7C 60 01 24 */	mtmsr r3
/* 80405774 003FB4F4  7C 9B 03 A6 */	mtspr 0x1b, r4
/* 80405778 003FB4F8  4B FF FA 39 */	bl TRKSaveExtended1Block
/* 8040577C 003FB4FC  3C 60 80 59 */	lis r3, lbl_8059B9F0@h
/* 80405780 003FB500  60 63 B9 F0 */	ori r3, r3, lbl_8059B9F0@l
/* 80405784 003FB504  B8 03 00 00 */	.4byte 0xB8030000  /* illegal lmw r0, 0(r3) */
/* 80405788 003FB508  38 00 00 00 */	li r0, 0
/* 8040578C 003FB50C  7C 12 FB A6 */	mtspr 0x3f2, r0
/* 80405790 003FB510  7C 15 FB A6 */	mtspr 0x3f5, r0
/* 80405794 003FB514  3C 20 80 5B */	lis r1, 0x805B7158@h
/* 80405798 003FB518  60 21 71 58 */	ori r1, r1, 0x805B7158@l
/* 8040579C 003FB51C  38 60 00 02 */	li r3, 2
/* 804057A0 003FB520  48 00 05 0D */	bl InitMetroTRKCommTable
/* 804057A4 003FB524  2C 03 00 01 */	cmpwi r3, 1
/* 804057A8 003FB528  40 82 00 14 */	bne lbl_804057BC
/* 804057AC 003FB52C  80 83 00 84 */	lwz r4, 0x84(r3)
/* 804057B0 003FB530  7C 88 03 A6 */	mtlr r4
/* 804057B4 003FB534  B8 03 00 00 */	.4byte 0xB8030000  /* illegal lmw r0, 0(r3) */
/* 804057B8 003FB538  4E 80 00 20 */	blr 
lbl_804057BC:
/* 804057BC 003FB53C  48 00 01 F8 */	b TRK_main
/* 804057C0 003FB540  4E 80 00 20 */	blr 

.global TRKInitializeTarget
TRKInitializeTarget:
/* 804057C4 003FB544  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 804057C8 003FB548  7C 08 02 A6 */	mflr r0
/* 804057CC 003FB54C  3C 60 80 5A */	lis r3, lbl_8059B94C@ha
/* 804057D0 003FB550  90 01 00 14 */	stw r0, 0x14(r1)
/* 804057D4 003FB554  38 00 00 01 */	li r0, 1
/* 804057D8 003FB558  38 63 B9 4C */	addi r3, r3, lbl_8059B94C@l
/* 804057DC 003FB55C  90 03 00 98 */	stw r0, 0x98(r3)
/* 804057E0 003FB560  4B FF DF 91 */	bl __TRK_get_MSR
/* 804057E4 003FB564  3C A0 80 5A */	lis r5, lbl_8059B94C@ha
/* 804057E8 003FB568  3C 80 80 5A */	lis r4, lbl_8059BEC8@ha
/* 804057EC 003FB56C  38 A5 B9 4C */	addi r5, r5, lbl_8059B94C@l
/* 804057F0 003FB570  3C 00 E0 00 */	lis r0, 0xe000
/* 804057F4 003FB574  90 65 00 8C */	stw r3, 0x8c(r5)
/* 804057F8 003FB578  38 60 00 00 */	li r3, 0
/* 804057FC 003FB57C  90 04 BE C8 */	stw r0, lbl_8059BEC8@l(r4)
/* 80405800 003FB580  80 01 00 14 */	lwz r0, 0x14(r1)
/* 80405804 003FB584  7C 08 03 A6 */	mtlr r0
/* 80405808 003FB588  38 21 00 10 */	addi r1, r1, 0x10
/* 8040580C 003FB58C  4E 80 00 20 */	blr 

.global __TRK_copy_vectors
__TRK_copy_vectors:
/* 80405810 003FB590  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 80405814 003FB594  7C 08 02 A6 */	mflr r0
/* 80405818 003FB598  3C 60 80 5A */	lis r3, lbl_8059BEC8@ha
/* 8040581C 003FB59C  90 01 00 24 */	stw r0, 0x24(r1)
/* 80405820 003FB5A0  38 63 BE C8 */	addi r3, r3, lbl_8059BEC8@l
/* 80405824 003FB5A4  BF 61 00 0C */	stmw r27, 0xc(r1)
/* 80405828 003FB5A8  80 63 00 00 */	lwz r3, 0(r3)
/* 8040582C 003FB5AC  28 03 00 44 */	cmplwi r3, 0x44
/* 80405830 003FB5B0  41 81 00 2C */	bgt lbl_8040585C
/* 80405834 003FB5B4  38 03 40 00 */	addi r0, r3, 0x4000
/* 80405838 003FB5B8  28 00 00 44 */	cmplwi r0, 0x44
/* 8040583C 003FB5BC  40 81 00 20 */	ble lbl_8040585C
/* 80405840 003FB5C0  3C 60 80 5A */	lis r3, lbl_8059B9F0@ha
/* 80405844 003FB5C4  38 63 B9 F0 */	addi r3, r3, lbl_8059B9F0@l
/* 80405848 003FB5C8  80 03 02 38 */	lwz r0, 0x238(r3)
/* 8040584C 003FB5CC  54 00 07 BF */	clrlwi. r0, r0, 0x1e
/* 80405850 003FB5D0  41 82 00 0C */	beq lbl_8040585C
/* 80405854 003FB5D4  38 A0 00 44 */	li r5, 0x44
/* 80405858 003FB5D8  48 00 00 0C */	b lbl_80405864
lbl_8040585C:
/* 8040585C 003FB5DC  3C 60 80 00 */	lis r3, 0x80000044@ha
/* 80405860 003FB5E0  38 A3 00 44 */	addi r5, r3, 0x80000044@l
lbl_80405864:
/* 80405864 003FB5E4  3C 80 80 49 */	lis r4, lbl_804947D0@ha
/* 80405868 003FB5E8  3C 60 80 5A */	lis r3, lbl_8059B9F0@ha
/* 8040586C 003FB5EC  83 A5 00 00 */	lwz r29, 0(r5)
/* 80405870 003FB5F0  3B E4 47 D0 */	addi r31, r4, lbl_804947D0@l
/* 80405874 003FB5F4  3B 83 B9 F0 */	addi r28, r3, lbl_8059B9F0@l
/* 80405878 003FB5F8  3B C0 00 00 */	li r30, 0
lbl_8040587C:
/* 8040587C 003FB5FC  38 00 00 01 */	li r0, 1
/* 80405880 003FB600  7C 00 F0 30 */	slw r0, r0, r30
/* 80405884 003FB604  7F A0 00 39 */	and. r0, r29, r0
/* 80405888 003FB608  41 82 00 90 */	beq lbl_80405918
/* 8040588C 003FB60C  2C 1E 00 04 */	cmpwi r30, 4
/* 80405890 003FB610  41 82 00 88 */	beq lbl_80405918
/* 80405894 003FB614  3C 60 80 5A */	lis r3, lbl_8059BEC8@ha
/* 80405898 003FB618  80 DF 00 00 */	lwz r6, 0(r31)
/* 8040589C 003FB61C  38 63 BE C8 */	addi r3, r3, lbl_8059BEC8@l
/* 804058A0 003FB620  80 63 00 00 */	lwz r3, 0(r3)
/* 804058A4 003FB624  7C 06 18 40 */	cmplw r6, r3
/* 804058A8 003FB628  41 80 00 24 */	blt lbl_804058CC
/* 804058AC 003FB62C  38 03 40 00 */	addi r0, r3, 0x4000
/* 804058B0 003FB630  7C 06 00 40 */	cmplw r6, r0
/* 804058B4 003FB634  40 80 00 18 */	bge lbl_804058CC
/* 804058B8 003FB638  80 1C 02 38 */	lwz r0, 0x238(r28)
/* 804058BC 003FB63C  54 00 07 BF */	clrlwi. r0, r0, 0x1e
/* 804058C0 003FB640  41 82 00 0C */	beq lbl_804058CC
/* 804058C4 003FB644  7C DB 33 78 */	mr r27, r6
/* 804058C8 003FB648  48 00 00 2C */	b lbl_804058F4
lbl_804058CC:
/* 804058CC 003FB64C  3C 00 7E 00 */	lis r0, 0x7e00
/* 804058D0 003FB650  7C 06 00 40 */	cmplw r6, r0
/* 804058D4 003FB654  41 80 00 18 */	blt lbl_804058EC
/* 804058D8 003FB658  3C 00 80 00 */	lis r0, 0x8000
/* 804058DC 003FB65C  7C 06 00 40 */	cmplw r6, r0
/* 804058E0 003FB660  41 81 00 0C */	bgt lbl_804058EC
/* 804058E4 003FB664  7C DB 33 78 */	mr r27, r6
/* 804058E8 003FB668  48 00 00 0C */	b lbl_804058F4
lbl_804058EC:
/* 804058EC 003FB66C  54 C0 00 BE */	clrlwi r0, r6, 2
/* 804058F0 003FB670  64 1B 80 00 */	oris r27, r0, 0x8000
lbl_804058F4:
/* 804058F4 003FB674  3C 80 80 00 */	lis r4, lbl_800044C0@ha
/* 804058F8 003FB678  7F 63 DB 78 */	mr r3, r27
/* 804058FC 003FB67C  38 04 44 C0 */	addi r0, r4, lbl_800044C0@l
/* 80405900 003FB680  38 A0 01 00 */	li r5, 0x100
/* 80405904 003FB684  7C 80 32 14 */	add r4, r0, r6
/* 80405908 003FB688  4B BF EB 95 */	bl func_8000449C
/* 8040590C 003FB68C  7F 63 DB 78 */	mr r3, r27
/* 80405910 003FB690  38 80 01 00 */	li r4, 0x100
/* 80405914 003FB694  4B FF DD 51 */	bl TRK_flush_cache
lbl_80405918:
/* 80405918 003FB698  3B DE 00 01 */	addi r30, r30, 1
/* 8040591C 003FB69C  3B FF 00 04 */	addi r31, r31, 4
/* 80405920 003FB6A0  2C 1E 00 0E */	cmpwi r30, 0xe
/* 80405924 003FB6A4  40 81 FF 58 */	ble lbl_8040587C
/* 80405928 003FB6A8  BB 61 00 0C */	lmw r27, 0xc(r1)
/* 8040592C 003FB6AC  80 01 00 24 */	lwz r0, 0x24(r1)
/* 80405930 003FB6B0  7C 08 03 A6 */	mtlr r0
/* 80405934 003FB6B4  38 21 00 20 */	addi r1, r1, 0x20
/* 80405938 003FB6B8  4E 80 00 20 */	blr 

.global TRKTargetTranslate
TRKTargetTranslate:
/* 8040593C 003FB6BC  3C 80 80 5A */	lis r4, lbl_8059BEC8@ha
/* 80405940 003FB6C0  38 84 BE C8 */	addi r4, r4, lbl_8059BEC8@l
/* 80405944 003FB6C4  80 84 00 00 */	lwz r4, 0(r4)
/* 80405948 003FB6C8  7C 03 20 40 */	cmplw r3, r4
/* 8040594C 003FB6CC  41 80 00 24 */	blt lbl_80405970
/* 80405950 003FB6D0  38 04 40 00 */	addi r0, r4, 0x4000
/* 80405954 003FB6D4  7C 03 00 40 */	cmplw r3, r0
/* 80405958 003FB6D8  40 80 00 18 */	bge lbl_80405970
/* 8040595C 003FB6DC  3C 80 80 5A */	lis r4, lbl_8059B9F0@ha
/* 80405960 003FB6E0  38 84 B9 F0 */	addi r4, r4, lbl_8059B9F0@l
/* 80405964 003FB6E4  80 04 02 38 */	lwz r0, 0x238(r4)
/* 80405968 003FB6E8  54 00 07 BF */	clrlwi. r0, r0, 0x1e
/* 8040596C 003FB6EC  4C 82 00 20 */	bnelr 
lbl_80405970:
/* 80405970 003FB6F0  3C 00 7E 00 */	lis r0, 0x7e00
/* 80405974 003FB6F4  7C 03 00 40 */	cmplw r3, r0
/* 80405978 003FB6F8  41 80 00 10 */	blt lbl_80405988
/* 8040597C 003FB6FC  3C 00 80 00 */	lis r0, 0x8000
/* 80405980 003FB700  7C 03 00 40 */	cmplw r3, r0
/* 80405984 003FB704  4C 81 00 20 */	blelr 
lbl_80405988:
/* 80405988 003FB708  54 60 00 BE */	clrlwi r0, r3, 2
/* 8040598C 003FB70C  64 03 80 00 */	oris r3, r0, 0x8000
/* 80405990 003FB710  4E 80 00 20 */	blr 

.global EnableMetroTRKInterrupts
EnableMetroTRKInterrupts:
/* 80405994 003FB714  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 80405998 003FB718  7C 08 02 A6 */	mflr r0
/* 8040599C 003FB71C  90 01 00 14 */	stw r0, 0x14(r1)
/* 804059A0 003FB720  48 00 02 75 */	bl EnableEXI2Interrupts
/* 804059A4 003FB724  80 01 00 14 */	lwz r0, 0x14(r1)
/* 804059A8 003FB728  7C 08 03 A6 */	mtlr r0
/* 804059AC 003FB72C  38 21 00 10 */	addi r1, r1, 0x10
/* 804059B0 003FB730  4E 80 00 20 */	blr 

