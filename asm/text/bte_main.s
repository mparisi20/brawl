.include "macros.inc"

.section .text, "ax"  # 0x8000C860 - 0x804064E0

.global BTUInterruptHandler
BTUInterruptHandler:
/* 80231A8C 0022780C  3C 80 80 53 */	lis r4, lbl_805287A0@ha
/* 80231A90 00227810  3C 60 80 23 */	lis r3, btu_task_msg_handler@ha
/* 80231A94 00227814  38 84 87 A0 */	addi r4, r4, lbl_805287A0@l
/* 80231A98 00227818  38 63 1C 24 */	addi r3, r3, btu_task_msg_handler@l
/* 80231A9C 0022781C  38 84 10 00 */	addi r4, r4, 0x1000
/* 80231AA0 00227820  4B FA 66 F4 */	b OSSwitchFiber

.global BTA_Init
BTA_Init:
/* 80231AA4 00227824  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 80231AA8 00227828  7C 08 02 A6 */	mflr r0
/* 80231AAC 0022782C  90 01 00 14 */	stw r0, 0x14(r1)
/* 80231AB0 00227830  38 00 00 00 */	li r0, 0
/* 80231AB4 00227834  93 E1 00 0C */	stw r31, 0xc(r1)
/* 80231AB8 00227838  90 0D C9 04 */	stw r0, lbl_805A0D24-_SDA_BASE_(r13)
/* 80231ABC 0022783C  4B FF E8 59 */	bl GKI_init
/* 80231AC0 00227840  4B FF EA 49 */	bl GKI_enable
/* 80231AC4 00227844  48 01 1B 15 */	bl BTE_Init
/* 80231AC8 00227848  3C 80 80 41 */	lis r4, lbl_8040D680@ha
/* 80231ACC 0022784C  38 0D A9 C0 */	addi r0, r13, lbl_8059EDE0-_SDA_BASE_
/* 80231AD0 00227850  38 84 D6 80 */	addi r4, r4, lbl_8040D680@l
/* 80231AD4 00227854  90 0D C8 FC */	stw r0, lbl_805A0D1C-_SDA_BASE_(r13)
/* 80231AD8 00227858  38 60 00 00 */	li r3, 0
/* 80231ADC 0022785C  90 8D C8 F8 */	stw r4, lbl_805A0D18-_SDA_BASE_(r13)
/* 80231AE0 00227860  4B FF FD 85 */	bl bte_hcisu_task
/* 80231AE4 00227864  48 00 00 0C */	b lbl_80231AF0
lbl_80231AE8:
/* 80231AE8 00227868  38 60 00 64 */	li r3, 0x64
/* 80231AEC 0022786C  4B FF E9 6D */	bl GKI_delay
lbl_80231AF0:
/* 80231AF0 00227870  80 0D A9 78 */	lwz r0, lbl_8059ED98-_SDA_BASE_(r13)
/* 80231AF4 00227874  2C 00 00 00 */	cmpwi r0, 0
/* 80231AF8 00227878  40 82 FF F0 */	bne lbl_80231AE8
/* 80231AFC 0022787C  48 00 00 E9 */	bl btu_task_init
/* 80231B00 00227880  3F E0 80 53 */	lis r31, lbl_805297A0@ha
/* 80231B04 00227884  38 7F 97 A0 */	addi r3, r31, lbl_805297A0@l
/* 80231B08 00227888  4B FA 4B 91 */	bl OSCreateAlarm
/* 80231B0C 0022788C  4B FB 00 29 */	bl OSGetTime
/* 80231B10 00227890  3C A0 80 00 */	lis r5, 0x800000F8@ha
/* 80231B14 00227894  3D 20 80 23 */	lis r9, BTUInterruptHandler@ha
/* 80231B18 00227898  80 05 00 F8 */	lwz r0, 0x800000F8@l(r5)
/* 80231B1C 0022789C  3C C0 10 62 */	lis r6, 0x10624DD3@ha
/* 80231B20 002278A0  7C 65 1B 78 */	mr r5, r3
/* 80231B24 002278A4  39 29 1A 8C */	addi r9, r9, BTUInterruptHandler@l
/* 80231B28 002278A8  38 66 4D D3 */	addi r3, r6, 0x10624DD3@l
/* 80231B2C 002278AC  54 00 F0 BE */	srwi r0, r0, 2
/* 80231B30 002278B0  7C 03 00 16 */	mulhwu r0, r3, r0
/* 80231B34 002278B4  7C 86 23 78 */	mr r6, r4
/* 80231B38 002278B8  38 7F 97 A0 */	addi r3, r31, -26720
/* 80231B3C 002278BC  38 E0 00 00 */	li r7, 0
/* 80231B40 002278C0  54 08 D9 7C */	rlwinm r8, r0, 0x1b, 5, 0x1e
/* 80231B44 002278C4  4B FA 4E 25 */	bl OSSetPeriodicAlarm
/* 80231B48 002278C8  38 60 00 00 */	li r3, 0
/* 80231B4C 002278CC  4B FF E9 01 */	bl GKI_run
/* 80231B50 002278D0  48 00 00 0C */	b lbl_80231B5C
lbl_80231B54:
/* 80231B54 002278D4  38 60 07 D0 */	li r3, 0x7d0
/* 80231B58 002278D8  4B FF E9 01 */	bl GKI_delay
lbl_80231B5C:
/* 80231B5C 002278DC  48 00 30 65 */	bl BTA_DmIsDeviceUp
/* 80231B60 002278E0  54 60 06 3F */	clrlwi. r0, r3, 0x18
/* 80231B64 002278E4  41 82 FF F0 */	beq lbl_80231B54
/* 80231B68 002278E8  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 80231B6C 002278EC  38 60 00 00 */	li r3, 0
/* 80231B70 002278F0  80 01 00 14 */	lwz r0, 0x14(r1)
/* 80231B74 002278F4  7C 08 03 A6 */	mtlr r0
/* 80231B78 002278F8  38 21 00 10 */	addi r1, r1, 0x10
/* 80231B7C 002278FC  4E 80 00 20 */	blr 

.global BTA_CleanUp
BTA_CleanUp:
/* 80231B80 00227900  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 80231B84 00227904  7C 08 02 A6 */	mflr r0
/* 80231B88 00227908  90 01 00 14 */	stw r0, 0x14(r1)
/* 80231B8C 0022790C  90 6D C9 04 */	stw r3, lbl_805A0D24-_SDA_BASE_(r13)
/* 80231B90 00227910  3C 60 80 53 */	lis r3, lbl_805297A0@ha
/* 80231B94 00227914  38 63 97 A0 */	addi r3, r3, lbl_805297A0@l
/* 80231B98 00227918  4B FA 4E 55 */	bl OSCancelAlarm
/* 80231B9C 0022791C  4B FF FD 2D */	bl bte_hcisu_close
/* 80231BA0 00227920  4B FF E8 05 */	bl GKI_shutdown
/* 80231BA4 00227924  80 01 00 14 */	lwz r0, 0x14(r1)
/* 80231BA8 00227928  7C 08 03 A6 */	mtlr r0
/* 80231BAC 0022792C  38 21 00 10 */	addi r1, r1, 0x10
/* 80231BB0 00227930  4E 80 00 20 */	blr 

.global bta_usb_close_evt
bta_usb_close_evt:
/* 80231BB4 00227934  81 8D C9 04 */	lwz r12, lbl_805A0D24-_SDA_BASE_(r13)
/* 80231BB8 00227938  2C 0C 00 00 */	cmpwi r12, 0
/* 80231BBC 0022793C  4D 82 00 20 */	beqlr 
/* 80231BC0 00227940  7C 60 07 75 */	extsb. r0, r3
/* 80231BC4 00227944  41 80 00 10 */	blt lbl_80231BD4
/* 80231BC8 00227948  38 60 00 00 */	li r3, 0
/* 80231BCC 0022794C  7D 89 03 A6 */	mtctr r12
/* 80231BD0 00227950  4E 80 04 20 */	bctr 
lbl_80231BD4:
/* 80231BD4 00227954  38 60 00 01 */	li r3, 1
/* 80231BD8 00227958  7D 89 03 A6 */	mtctr r12
/* 80231BDC 0022795C  4E 80 04 20 */	bctr 
/* 80231BE0 00227960  4E 80 00 20 */	blr 

